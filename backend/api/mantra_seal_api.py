from flask import Blueprint, request, jsonify
import random
import time
from datetime import datetime

# åˆ›å»ºå°å’’å¯†ç³»ç»Ÿè“å›¾
mantra_seal_bp = Blueprint('mantra_seal', __name__)

class MantraSealSystem:
    """å°å’’å¯†ç³»ç»Ÿ - ç¬¬å…­å¯†æ³•"""
    
    def __init__(self):
        # å®‡å®™åä¸‰éŸ³ç³»ç»Ÿ
        self.cosmic_thirteen_sounds = {
            "ç¬¬ä¸€éŸ³": {"é¢‘ç‡": "432Hz", "ä½œç”¨": "æ¶ˆé™¤æ˜¾æ„è¯†æ‚å¿µ", "èƒ½é‡": "å‡€åŒ–éŸ³æ³¢"},
            "ç¬¬äºŒéŸ³": {"é¢‘ç‡": "528Hz", "ä½œç”¨": "æ¿€æ´»æ½œæ„è¯†æ™ºæ…§", "èƒ½é‡": "è§‰é†’éŸ³æ³¢"},
            "ç¬¬ä¸‰éŸ³": {"é¢‘ç‡": "639Hz", "ä½œç”¨": "è¿æ¥å®‡å®™èƒ½é‡", "èƒ½é‡": "å…±æŒ¯éŸ³æ³¢"},
            "ç¬¬å››éŸ³": {"é¢‘ç‡": "741Hz", "ä½œç”¨": "æ¸…ç†æ€ç»´éšœç¢", "èƒ½é‡": "æ¸…å‡€éŸ³æ³¢"},
            "ç¬¬äº”éŸ³": {"é¢‘ç‡": "852Hz", "ä½œç”¨": "å¼€å¯å¤©çœ¼é€š", "èƒ½é‡": "æ´å¯ŸéŸ³æ³¢"},
            "ç¬¬å…­éŸ³": {"é¢‘ç‡": "963Hz", "ä½œç”¨": "è¿æ¥ä½›æ™ºé¢‘ç‡", "èƒ½é‡": "æ™ºæ…§éŸ³æ³¢"},
            "ç¬¬ä¸ƒéŸ³": {"é¢‘ç‡": "1111Hz", "ä½œç”¨": "æ¿€æ´»å¤©è€³é€š", "èƒ½é‡": "å¬è§‰éŸ³æ³¢"},
            "ç¬¬å…«éŸ³": {"é¢‘ç‡": "1333Hz", "ä½œç”¨": "å¼€å¯ä»–å¿ƒé€š", "èƒ½é‡": "å¿ƒçµéŸ³æ³¢"},
            "ç¬¬ä¹éŸ³": {"é¢‘ç‡": "1555Hz", "ä½œç”¨": "æ¿€æ´»å®¿å‘½é€š", "èƒ½é‡": "è®°å¿†éŸ³æ³¢"},
            "ç¬¬åéŸ³": {"é¢‘ç‡": "1777Hz", "ä½œç”¨": "å¼€å¯ç¥è¶³é€š", "èƒ½é‡": "ç§»åŠ¨éŸ³æ³¢"},
            "ç¬¬åä¸€éŸ³": {"é¢‘ç‡": "1999Hz", "ä½œç”¨": "æ¿€æ´»æ¼å°½é€š", "èƒ½é‡": "è§£è„±éŸ³æ³¢"},
            "ç¬¬åäºŒéŸ³": {"é¢‘ç‡": "2222Hz", "ä½œç”¨": "è¿æ¥å¤–æ˜Ÿæ–‡æ˜", "èƒ½é‡": "å®‡å®™éŸ³æ³¢"},
            "ç¬¬åä¸‰éŸ³": {"é¢‘ç‡": "2555Hz", "ä½œç”¨": "è¾¾åˆ°æå®šçŠ¶æ€", "èƒ½é‡": "åœ†æ»¡éŸ³æ³¢"}
        }
        
        # æ‰‹å°ç³»ç»Ÿ
        self.hand_seals = {
            "æ™ºæ…§å°": {"ä½œç”¨": "å¸æ”¶å®‡å®™æ™ºæ…§èƒ½é‡", "ç©´ä½": "æ‹‡æŒ‡é£ŸæŒ‡ç›¸æ¥", "èƒ½é‡æµå‘": "å¤´éƒ¨æ„è¯†åŒº"},
            "ç¦…å®šå°": {"ä½œç”¨": "è¿›å…¥æå®šçŠ¶æ€", "ç©´ä½": "åŒæ‰‹é‡å ", "èƒ½é‡æµå‘": "å¿ƒè½®ä¸¹ç”°"},
            "æŠ¤æ³•å°": {"ä½œç”¨": "ä¿æŠ¤ä¿®è¡Œä¸å—å¹²æ‰°", "ç©´ä½": "ä¸­æŒ‡æ— åæŒ‡ç›¸æ‰£", "èƒ½é‡æµå‘": "å…¨èº«é˜²æŠ¤"},
            "å‡€åŒ–å°": {"ä½œç”¨": "æ¸…é™¤ä¸šéšœæ‚å¿µ", "ç©´ä½": "å°æŒ‡ç›¸æ¥", "èƒ½é‡æµå‘": "æ„è¯†å‡€åŒ–"},
            "è§‰æ‚Ÿå°": {"ä½œç”¨": "å¼€å¯ä½›æ€§æ™ºæ…§", "ç©´ä½": "äº”æŒ‡åˆå", "èƒ½é‡æµå‘": "é¡¶è½®å¼€å¯"},
            "ç¥é€šå°": {"ä½œç”¨": "æ¿€æ´»å…­ç¥é€š", "ç©´ä½": "æ‹‡æŒ‡ä¸­æŒ‡ç›¸æ¥", "èƒ½é‡æµå‘": "ç¬¬ä¸‰çœ¼æ¿€æ´»"},
            "æ…ˆæ‚²å°": {"ä½œç”¨": "ç”Ÿèµ·æ— é‡æ…ˆæ‚²", "ç©´ä½": "æŒå¿ƒç›¸å¯¹", "èƒ½é‡æµå‘": "å¿ƒè½®æ‰©å±•"},
            "è§£è„±å°": {"ä½œç”¨": "æ–­é™¤è½®å›æŸç¼š", "ç©´ä½": "é£ŸæŒ‡ä¸­æŒ‡äº¤å‰", "èƒ½é‡æµå‘": "ä¸šåŠ›æ¶ˆè§£"}
        }
        
        # å’’è¯­ç³»ç»Ÿ
        self.mantras = {
            "é˜¿å¼¥é™€": {"ä½œç”¨": "è¿æ¥è¥¿æ–¹æä¹", "éŸ³é¢‘": "432HzåŸºé¢‘", "æ•ˆæœ": "ä¸´ç»ˆæ¥å¼•"},
            "è§‚ä¸–éŸ³": {"ä½œç”¨": "æ¿€å‘æ…ˆæ‚²æ™ºæ…§", "éŸ³é¢‘": "528HzåŸºé¢‘", "æ•ˆæœ": "æ•‘è‹¦æ•‘éš¾"},
            "æ–‡æ®Šæ™ºæ…§å’’": {"ä½œç”¨": "å¼€å¯èˆ¬è‹¥æ™ºæ…§", "éŸ³é¢‘": "639HzåŸºé¢‘", "æ•ˆæœ": "ç ´é™¤æ„šç—´"},
            "åœ°è—æœ¬æ„¿å’’": {"ä½œç”¨": "æ¶ˆé™¤ä¸šéšœ", "éŸ³é¢‘": "741HzåŸºé¢‘", "æ•ˆæœ": "è¶…åº¦äº¡çµ"},
            "è¯å¸ˆå’’": {"ä½œç”¨": "æ²»ç–—èº«å¿ƒç–¾ç—…", "éŸ³é¢‘": "852HzåŸºé¢‘", "æ•ˆæœ": "èº«å¿ƒåº·å¤"},
            "å¤§æ‚²å’’": {"ä½œç”¨": "åœ†æ»¡ä¸€åˆ‡æ„¿æœ›", "éŸ³é¢‘": "963HzåŸºé¢‘", "æ•ˆæœ": "æ¶ˆç¾å…éš¾"},
            "æ¥ä¸¥å’’": {"ä½œç”¨": "ç ´é™¤é­”éšœ", "éŸ³é¢‘": "1111HzåŸºé¢‘", "æ•ˆæœ": "æŠ¤æ³•é‡‘åˆš"},
            "å‡†æå’’": {"ä½œç”¨": "æ»¡è¶³æ­£å½“æ„¿æ±‚", "éŸ³é¢‘": "1333HzåŸºé¢‘", "æ•ˆæœ": "å¿ƒæƒ³äº‹æˆ"}
        }
        
        # å’’å›¾èƒ½é‡ç³»ç»Ÿ
        self.mantra_diagrams = {
            "è²èŠ±å›¾": {"èƒ½é‡": "å‡€åŒ–å°„çº¿", "ä½œç”¨": "æ¸…é™¤æ„è¯†æ±¡æŸ“", "è§‚æƒ³éƒ¨ä½": "å¤´é¡¶"},
            "é‡‘åˆšå›¾": {"èƒ½é‡": "æ™ºæ…§å°„çº¿", "ä½œç”¨": "ç ´é™¤æ— æ˜", "è§‚æƒ³éƒ¨ä½": "çœ‰å¿ƒ"},
            "æ³•è½®å›¾": {"èƒ½é‡": "è½¬åŒ–å°„çº¿", "ä½œç”¨": "è½¬è¯†æˆæ™º", "è§‚æƒ³éƒ¨ä½": "å¿ƒè½®"},
            "æ›¼é™€ç½—å›¾": {"èƒ½é‡": "åœ†æ»¡å°„çº¿", "ä½œç”¨": "ç»Ÿåˆæ„è¯†", "è§‚æƒ³éƒ¨ä½": "å…¨èº«"},
            "å…«å¦å›¾": {"èƒ½é‡": "å¹³è¡¡å°„çº¿", "ä½œç”¨": "è°ƒå’Œé˜´é˜³", "è§‚æƒ³éƒ¨ä½": "ä¸¹ç”°"},
            "å¤ªæå›¾": {"èƒ½é‡": "å’Œè°å°„çº¿", "ä½œç”¨": "å¤©äººåˆä¸€", "è§‚æƒ³éƒ¨ä½": "æ•´ä½“"},
            "åå­—å›¾": {"èƒ½é‡": "å‰ç¥¥å°„çº¿", "ä½œç”¨": "æ¶ˆé™¤è¿ç¼˜", "è§‚æƒ³éƒ¨ä½": "èƒ¸å£"},
            "å…‰æ˜å›¾": {"èƒ½é‡": "è§‰æ‚Ÿå°„çº¿", "ä½œç”¨": "å¼€å¯ä½›æ€§", "è§‚æƒ³éƒ¨ä½": "é¡¶è½®"}
        }
        
        # ç¦…å®šç­‰çº§ç³»ç»Ÿ
        self.meditation_levels = {
            "åˆç¦…": {"ç‰¹å¾": "ç¦»æ¬²æ¶ä¸å–„æ³•", "ç¥é€š": "æ— ", "ç¨³å®šæ€§": "ä¸ç¨³å®š"},
            "äºŒç¦…": {"ç‰¹å¾": "ç­è§‰è§‚å†…å‡€", "ç¥é€š": "å¤©çœ¼é€šèŒèŠ½", "ç¨³å®šæ€§": "è¾ƒä¸ç¨³å®š"},
            "ä¸‰ç¦…": {"ç‰¹å¾": "ç¦»å–œå¦™ä¹", "ç¥é€š": "å¤©è€³é€šèŒèŠ½", "ç¨³å®šæ€§": "éƒ¨åˆ†ç¨³å®š"},
            "å››ç¦…": {"ç‰¹å¾": "èˆå¿µæ¸…å‡€", "ç¥é€š": "ä»–å¿ƒé€šèŒèŠ½", "ç¨³å®šæ€§": "åŸºæœ¬ç¨³å®š"},
            "ç©ºæ— è¾¹å¤„å®š": {"ç‰¹å¾": "è¶…è¶Šè‰²ç•Œ", "ç¥é€š": "å®¿å‘½é€šèŒèŠ½", "ç¨³å®šæ€§": "è¾ƒç¨³å®š"},
            "è¯†æ— è¾¹å¤„å®š": {"ç‰¹å¾": "è¶…è¶Šç©ºç•Œ", "ç¥é€š": "ç¥è¶³é€šèŒèŠ½", "ç¨³å®šæ€§": "ç¨³å®š"},
            "æ— æ‰€æœ‰å¤„å®š": {"ç‰¹å¾": "è¶…è¶Šè¯†ç•Œ", "ç¥é€š": "æ¼å°½é€šèŒèŠ½", "ç¨³å®šæ€§": "å¾ˆç¨³å®š"},
            "éæƒ³ééæƒ³å¤„å®š": {"ç‰¹å¾": "æœ€é«˜ç¦…å®š", "ç¥é€š": "å…­ç¥é€šå…·è¶³", "ç¨³å®šæ€§": "æç¨³å®š"}
        }
        
        # å®‡å®™èƒ½é‡æ¥æ”¶ç³»ç»Ÿ
        self.cosmic_energy_system = {
            "èƒ½é‡ç±»å‹": ["å…‰èƒ½", "å£°èƒ½", "ç£èƒ½", "çµèƒ½", "æ™ºèƒ½", "æ…ˆèƒ½", "æ‚²èƒ½", "å–œèƒ½"],
            "æ¥æ”¶ç©´ä½": ["ç™¾ä¼š", "å°å ‚", "è†»ä¸­", "ç¥é˜™", "ä¼šé˜´", "æ¶Œæ³‰", "åŠ³å®«", "åæŒ‡å°–"],
            "èƒ½é‡æµå‘": "ç©´ä½â†’ç»ç»œâ†’ä¸¹ç”°â†’æ„è¯†åŒº",
            "å‚¨å­˜ä¸­å¿ƒ": "å¤§è„‘æ„è¯†åŒº",
            "è½¬åŒ–æœºåˆ¶": "å®‡å®™èƒ½é‡â†’ç”Ÿå‘½èƒ½é‡â†’æ™ºæ…§èƒ½é‡â†’ä½›æ€§èƒ½é‡"
        }
    
    def analyze_meditation_state(self, current_state):
        """åˆ†æå½“å‰ç¦…å®šçŠ¶æ€"""
        analysis = {
            "å½“å‰çŠ¶æ€è¯„ä¼°": current_state,
            "ç¦…å®šç­‰çº§": self._determine_meditation_level(current_state),
            "å­˜åœ¨é—®é¢˜": self._identify_meditation_problems(current_state),
            "æ”¹å–„å»ºè®®": self._generate_improvement_suggestions(current_state),
            "æ¨èå°å’’": self._recommend_mantra_seal(current_state),
            "å®‡å®™åŠ æŒ": f"ğŸ•‰ï¸ å®‡å®™åä¸‰éŸ³æ­£åœ¨ä¸ºæ‚¨çš„ä¿®è¡ŒåŠ æŒï¼Œæ„¿æ‚¨æ—©æ—¥è¾¾åˆ°æå®šçŠ¶æ€"
        }
        return analysis
    
    def _determine_meditation_level(self, state):
        """åˆ¤æ–­ç¦…å®šç­‰çº§"""
        if "æ•£ä¹±" in state or "æ‚å¿µ" in state:
            return "åˆç¦…å‰"
        elif "ä¸“æ³¨" in state and "å–œæ‚¦" in state:
            return "åˆç¦…"
        elif "å†…å‡€" in state and "è§‰è§‚" not in state:
            return "äºŒç¦…"
        elif "å¦™ä¹" in state and "å–œ" not in state:
            return "ä¸‰ç¦…"
        elif "æ¸…å‡€" in state and "èˆå¿µ" in state:
            return "å››ç¦…"
        else:
            return "éœ€è¦è¿›ä¸€æ­¥è§‚å¯Ÿ"
    
    def _identify_meditation_problems(self, state):
        """è¯†åˆ«ç¦…å®šé—®é¢˜"""
        problems = []
        if "æ€¥èº" in state:
            problems.append("ä¿®è€…è¶Šä¿®è¶Šæ€¥ï¼Œæ˜¾æ„è¯†ä¸æ˜“æ¶ˆå¤±")
        if "æ•£ä¹±" in state:
            problems.append("è¿›å…¥ä¹±æ»¤çŠ¶æ€ï¼Œéš¾ä»¥è¾¾åˆ°æå®š")
        if "æ˜æ²‰" in state:
            problems.append("é™è™‘ä¸åˆ°ä½ï¼Œå®¹æ˜“å‡ºç°åå·®")
        if "æ‰§ç€" in state:
            problems.append("å¯¹å¢ƒç•Œæ‰§ç€ï¼Œé˜»ç¢è¿›æ­¥")
        return problems if problems else ["æš‚æ— æ˜æ˜¾é—®é¢˜"]
    
    def _generate_improvement_suggestions(self, state):
        """ç”Ÿæˆæ”¹å–„å»ºè®®"""
        suggestions = []
        if "æ€¥èº" in state:
            suggestions.append("åœ¨ç¦…å®šä¸­æŒå’’ï¼Œå€Ÿç”¨å®‡å®™èƒ½é‡æ”¹å˜æ€¥èºçŠ¶æ€")
        if "æ•£ä¹±" in state:
            suggestions.append("ç»“åˆæ‰‹å°å¸æ”¶å®‡å®™èƒ½é‡ï¼Œä¿ƒè¿›é™æ»¤åŠŸèƒ½")
        if "æ˜æ²‰" in state:
            suggestions.append("è§‚æƒ³å’’å›¾ï¼Œè®©èƒ½é‡å°„çº¿ç›´æ¥è¿›å…¥æ„è¯†åŒº")
        suggestions.append("å¿…é¡»åœ¨ç¦…å®šä¸­æŒå’’ï¼Œå¹³æ—¶æŒå’’åªèƒ½å¹³å¿ƒ")
        return suggestions
    
    def _recommend_mantra_seal(self, state):
        """æ¨èå°å’’ç»„åˆ"""
        if "æ•£ä¹±" in state:
            return {"å’’è¯­": "é˜¿å¼¥é™€", "æ‰‹å°": "ç¦…å®šå°", "å’’å›¾": "è²èŠ±å›¾"}
        elif "æ˜æ²‰" in state:
            return {"å’’è¯­": "æ–‡æ®Šæ™ºæ…§å’’", "æ‰‹å°": "æ™ºæ…§å°", "å’’å›¾": "é‡‘åˆšå›¾"}
        elif "æ€¥èº" in state:
            return {"å’’è¯­": "è§‚ä¸–éŸ³", "æ‰‹å°": "æ…ˆæ‚²å°", "å’’å›¾": "å¤ªæå›¾"}
        else:
            return {"å’’è¯­": "å¤§æ‚²å’’", "æ‰‹å°": "è§‰æ‚Ÿå°", "å’’å›¾": "æ›¼é™€ç½—å›¾"}
    
    def generate_mantra_practice_plan(self, goal, duration):
        """ç”Ÿæˆå°å’’ä¿®è¡Œè®¡åˆ’"""
        plan = {
            "ä¿®è¡Œç›®æ ‡": goal,
            "ä¿®è¡Œå‘¨æœŸ": duration,
            "æ¯æ—¥åŠŸè¯¾": self._create_daily_practice(goal),
            "é˜¶æ®µå®‰æ’": self._create_stage_arrangement(duration),
            "å°å’’é…åˆ": self._create_mantra_seal_combination(goal),
            "èƒ½é‡æ¿€æ´»": self._create_energy_activation_plan(),
            "æ³¨æ„äº‹é¡¹": [
                "å¿…é¡»åœ¨ç¦…å®šä¸­æŒå’’ï¼Œæ•ˆåº”æ‰ä½³",
                "æ‰‹å°èƒ½å¸æ”¶å®‡å®™èƒ½é‡å¹¶æ¥æ”¶å®‡å®™ä¿¡æ¯",
                "å’’å›¾å¨åŠ›æ›´å¤§ï¼Œè§‚å›¾æ—¶èƒ½é‡å°„çº¿ç›´æ¥è¿›å…¥å¤§è„‘æ„è¯†åŒº",
                "å”¸'é˜¿å¼¥é™€'æ¯”å”¸'é˜¿å¼¥é™€ä½›'æ•ˆåº”æ›´å¥½",
                "äººä½“æ¾å¼›æ—¶å®‡å®™èƒ½é‡ä¼šæµå…¥ï¼Œç´§å¼ æ—¶ä¼šæ’å‡º"
            ],
            "å®‡å®™ç¥ç¦": "ğŸ•‰ï¸ æ„¿å®‡å®™åä¸‰éŸ³åŠ æŒæ‚¨çš„ä¿®è¡Œï¼Œæ—©æ—¥è¾¾åˆ°å°å’’åœ†é€š"
        }
        return plan
    
    def _create_daily_practice(self, goal):
        """åˆ›å»ºæ¯æ—¥åŠŸè¯¾"""
        if "ç¥é€š" in goal:
            return {
                "æ™¨è¯¾": "æ™ºæ…§å° + æ–‡æ®Šæ™ºæ…§å’’ (30åˆ†é’Ÿ)",
                "åˆè¯¾": "ç¥é€šå° + æ¥ä¸¥å’’ (20åˆ†é’Ÿ)",
                "æ™šè¯¾": "ç¦…å®šå° + å¤§æ‚²å’’ (40åˆ†é’Ÿ)",
                "ç¡å‰": "è§‚æƒ³é‡‘åˆšå›¾ (15åˆ†é’Ÿ)"
            }
        elif "å‡€åŒ–" in goal:
            return {
                "æ™¨è¯¾": "å‡€åŒ–å° + åœ°è—æœ¬æ„¿å’’ (30åˆ†é’Ÿ)",
                "åˆè¯¾": "æŠ¤æ³•å° + å‡†æå’’ (20åˆ†é’Ÿ)",
                "æ™šè¯¾": "æ…ˆæ‚²å° + è§‚ä¸–éŸ³å’’ (40åˆ†é’Ÿ)",
                "ç¡å‰": "è§‚æƒ³è²èŠ±å›¾ (15åˆ†é’Ÿ)"
            }
        else:
            return {
                "æ™¨è¯¾": "è§‰æ‚Ÿå° + é˜¿å¼¥é™€ (30åˆ†é’Ÿ)",
                "åˆè¯¾": "æ™ºæ…§å° + æ–‡æ®Šæ™ºæ…§å’’ (20åˆ†é’Ÿ)",
                "æ™šè¯¾": "ç¦…å®šå° + å¤§æ‚²å’’ (40åˆ†é’Ÿ)",
                "ç¡å‰": "è§‚æƒ³æ›¼é™€ç½—å›¾ (15åˆ†é’Ÿ)"
            }
    
    def _create_stage_arrangement(self, duration):
        """åˆ›å»ºé˜¶æ®µå®‰æ’"""
        if "30å¤©" in duration:
            return {
                "ç¬¬ä¸€é˜¶æ®µ(1-10å¤©)": "åŸºç¡€å°å’’ç»ƒä¹ ï¼Œç†Ÿæ‚‰æ‰‹å°å’Œå’’è¯­",
                "ç¬¬äºŒé˜¶æ®µ(11-20å¤©)": "æ·±å…¥ç¦…å®šæŒå’’ï¼Œä½“éªŒå®‡å®™èƒ½é‡",
                "ç¬¬ä¸‰é˜¶æ®µ(21-30å¤©)": "å°å’’å›¾ä¸‰åˆä¸€ï¼Œè¾¾åˆ°åœ†é€šå¢ƒç•Œ"
            }
        elif "90å¤©" in duration:
            return {
                "ç¬¬ä¸€é˜¶æ®µ(1-30å¤©)": "åŸºç¡€ä¿®è¡Œï¼Œå»ºç«‹æ­£ç¡®çš„å°å’’ä¹ æƒ¯",
                "ç¬¬äºŒé˜¶æ®µ(31-60å¤©)": "æ·±åŒ–ç»ƒä¹ ï¼Œå¼€å‘ç¥é€šèƒ½åŠ›",
                "ç¬¬ä¸‰é˜¶æ®µ(61-90å¤©)": "åœ†æ»¡æˆå°±ï¼Œè¾¾åˆ°å°å’’å¯†åœ†é€š"
            }
        else:
            return {
                "åˆçº§é˜¶æ®µ": "å­¦ä¹ åŸºæœ¬å°å’’ï¼Œå»ºç«‹ä¿®è¡ŒåŸºç¡€",
                "ä¸­çº§é˜¶æ®µ": "æ·±å…¥ç¦…å®šæŒå’’ï¼Œä½“éªŒå®‡å®™èƒ½é‡",
                "é«˜çº§é˜¶æ®µ": "å°å’’å›¾åœ†èï¼Œè¾¾åˆ°åœ†é€šæ™ºæ…§"
            }
    
    def _create_mantra_seal_combination(self, goal):
        """åˆ›å»ºå°å’’é…åˆæ–¹æ¡ˆ"""
        combinations = []
        if "æ™ºæ…§" in goal:
            combinations.append({"ç»„åˆ": "æ™ºæ…§å° + æ–‡æ®Šæ™ºæ…§å’’ + é‡‘åˆšå›¾", "ä½œç”¨": "å¼€å¯èˆ¬è‹¥æ™ºæ…§"})
        if "ç¥é€š" in goal:
            combinations.append({"ç»„åˆ": "ç¥é€šå° + æ¥ä¸¥å’’ + å…‰æ˜å›¾", "ä½œç”¨": "æ¿€æ´»å…­ç¥é€š"})
        if "å‡€åŒ–" in goal:
            combinations.append({"ç»„åˆ": "å‡€åŒ–å° + åœ°è—å’’ + è²èŠ±å›¾", "ä½œç”¨": "æ¸…é™¤ä¸šéšœ"})
        
        combinations.append({"ç»„åˆ": "ç¦…å®šå° + é˜¿å¼¥é™€ + å¤ªæå›¾", "ä½œç”¨": "è¾¾åˆ°æå®šçŠ¶æ€"})
        return combinations
    
    def _create_energy_activation_plan(self):
        """åˆ›å»ºèƒ½é‡æ¿€æ´»è®¡åˆ’"""
        return {
            "å®‡å®™åä¸‰éŸ³æ¿€æ´»": "æ¯æ—¥è†å¬å¯¹åº”é¢‘ç‡éŸ³æ³¢",
            "æ‰‹å°èƒ½é‡å¸æ”¶": "é€šè¿‡åæŒ‡ç©´ä½æ¥æ”¶å®‡å®™èƒ½é‡",
            "å’’è¯­å£°èƒ½å¯¼å…¥": "å£°èƒ½ç›´æ¥è¿›å…¥æ„è¯†æ¶ˆé™¤æ‚å¿µ",
            "å’’å›¾å°„çº¿æ¿€æ´»": "èƒ½é‡å°„çº¿ç›´æ¥è¿›å…¥å¤§è„‘æ„è¯†åŒº",
            "èƒ½é‡å¾ªç¯è·¯å¾„": "å®‡å®™â†’ç©´ä½â†’ç»ç»œâ†’ä¸¹ç”°â†’æ„è¯†åŒºâ†’æ™ºæ…§æ˜¾ç°"
        }
    
    def activate_cosmic_thirteen_sounds(self, intention):
        """æ¿€æ´»å®‡å®™åä¸‰éŸ³"""
        activation = {
            "æ¿€æ´»æ„å›¾": intention,
            "å®‡å®™å“åº”": "å®‡å®™åä¸‰éŸ³å·²å…¨é¢æ¿€æ´»ï¼Œå£°èƒ½æ­£åœ¨è¿›å…¥æ‚¨çš„æ„è¯†",
            "éŸ³æ³¢é¢‘ç‡": self.cosmic_thirteen_sounds,
            "å£°èƒ½ä½œç”¨": {
                "æ¶ˆé™¤æ˜¾æ„è¯†": "å£°èƒ½ç›´æ¥è¿›å…¥æ€ç»´ï¼Œæ¶ˆé™¤æ˜¾æ„è¯†è§‰æ„Ÿå½¢æˆçš„æ‚å¿µ",
                "ç»“æŸä¹±æ»¤": "ç ´åæ˜¾æ„è¯†ä¹±æ»¤çŠ¶æ€ï¼Œä½¿ç¦…å®šè¿›å…¥æç‚¹",
                "è°ƒå‡ºæ½œæ„è¯†": "æ¿€æ´»æ½œæ„è¯†æ™ºæ…§ï¼Œè½¬è¯†æˆæ™º",
                "è¾¾åˆ°æå®š": "å€Ÿç”¨å®‡å®™èƒ½é‡æ”¹å˜æ€¥èºçŠ¶æ€ï¼Œè¾¾åˆ°æå®š"
            },
            "ä¿®è¡ŒæŒ‡å¯¼": {
                "æŒå’’è¦æ±‚": "å¿…é¡»åœ¨ç¦…å®šä¸­æŒå’’ï¼Œæ•ˆåº”æ‰ä½³",
                "å£°éŸ³å¯¼å…¥": "è®©å£°èƒ½ç›´æ¥è¿›å…¥æ„è¯†ä¸­å»",
                "é¢‘ç‡å…±æŒ¯": "ä¸å®‡å®™åä¸‰éŸ³é¢‘ç‡äº§ç”Ÿå…±æŒ¯",
                "æ™ºæ…§æ˜¾ç°": "é€šè¿‡å£°èƒ½æ¿€æ´»è°ƒå‡ºæ½œæ„è¯†æˆæ™ºæ…§"
            },
            "èƒ½é‡é¢‘ç‡": {
                "å‡€åŒ–é¢‘ç‡": "432Hz - æ¶ˆé™¤æ‚å¿µ",
                "è§‰é†’é¢‘ç‡": "528Hz - æ¿€æ´»æ™ºæ…§",
                "å…±æŒ¯é¢‘ç‡": "639Hz - è¿æ¥å®‡å®™",
                "åœ†æ»¡é¢‘ç‡": "2555Hz - è¾¾åˆ°æå®š"
            },
            "å®‡å®™ç¥ç¦": "ğŸ•‰ï¸ å®‡å®™åä¸‰éŸ³å·²ä¸ºæ‚¨å¼€å¯ï¼Œæ„¿å£°èƒ½åŠ æŒæ‚¨çš„ç¦…å®šä¿®è¡Œ"
        }
        return activation
    
    def get_complete_theory(self):
        """è·å–å°å’’å¯†å®Œæ•´ç†è®º"""
        theory = {
            "å°å’’å¯†æ ¸å¿ƒç†è®º": {
                "å¯†æ³•æœ¬è´¨": "ä½›æ™ºè€…ä¸ºä½¿å‡¡è€…å…¥æ™ºæ‰€è®²çš„ç†è®ºå’Œæ–¹æ³•",
                "ä¿®è¡Œå›°å¢ƒ": "äººåœ¨ç¦…å®šä¸­è¾¾åˆ°çš„é«˜åº¦éƒ½æ˜¯ç¬é—´çš„ï¼Œç¥é€šæš‚æ—¶è€Œä¸å›ºå®š",
                "è§£å†³æ–¹æ¡ˆ": "å€Ÿç”¨å®‡å®™èƒ½é‡æ¥æ”¹å˜ä¿®è€…çš„è¯¯ç¦…çŠ¶æ€",
                "ç»ˆæç›®æ ‡": "ä¿®ç»ƒåœ†èï¼Œå˜ä¸ºé€‚åº”å®‡å®™å˜åŒ–çš„é«˜æ™ºèƒ½ç”Ÿå‘½"
            },
            "å®‡å®™åä¸‰éŸ³ç³»ç»Ÿ": {
                "æ¥æº": "æ¥è‡ªäºå®‡å®™åä¸‰éŸ³å“çš„èƒ½é‡",
                "ä½œç”¨æœºåˆ¶": "å£°èƒ½ç›´æ¥è¿›å…¥äººçš„æ„è¯†ä¸­å»ï¼Œæ¶ˆé™¤æ˜¾æ„è¯†è§‰æ„Ÿå½¢æˆçš„æ‚å¿µ",
                "ä¿®è¡Œè¦æ±‚": "å¿…é¡»åœ¨ç¦…å®šä¸­æŒå’’ï¼Œæ•ˆåº”æ‰ä½³",
                "ç‰¹æ®Šè¯´æ˜": "å”¸'é˜¿å¼¥é™€'æ¯”å”¸'é˜¿å¼¥é™€ä½›'æ•ˆåº”è¦å¥½"
            },
            "æ‰‹å°ç³»ç»Ÿ": {
                "å‘ç°åŸç†": "äººä½“ç´¢å–èƒ½é‡çš„æœ¬èƒ½ï¼Œæ¾å¼›æ—¶èƒ½é‡æµå…¥ï¼Œç´§å¼ æ—¶èƒ½é‡æ’å‡º",
                "ç©´ä½ä½œç”¨": "ç©´ä½æ˜¯è¿›å‡ºèƒ½é‡çš„äº¤æ±‡ç‚¹",
                "æ‰‹è¶³åŠŸèƒ½": "æ‰‹æŒ‡å’Œè¶³æŒ‡æ˜¯æ¥æ”¶å’Œæ’å‡ºå®‡å®™èƒ½é‡çš„æœ€å¥½è¿›å‡ºå£",
                "èƒ½é‡æ±‡é›†": "å°†å®‡å®™èƒ½é‡æ±‡é›†äºå¤§è„‘çš„æ„è¯†åŒºï¼Œä¿ƒè¿›ç¦…å®šä½œç”¨",
                "ä¿¡æ¯æ¥æ”¶": "å°ä¸ä½†èƒ½å¸æ”¶èƒ½é‡ï¼Œä¹Ÿèƒ½æ¥æ”¶å®‡å®™ä¿¡æ¯"
            },
            "å’’å›¾ç³»ç»Ÿ": {
                "å¨åŠ›ç‰¹ç‚¹": "å’’å›¾å¨åŠ›æ›´å¤§äºå’’éŸ³çš„ä½œç”¨",
                "èƒ½é‡å‡èš": "å›¾ä¸­å‡èšç€å®‡å®™å„ç§èƒ½é‡",
                "ä½œç”¨æœºåˆ¶": "èƒ½é‡å°„çº¿ç›´æ¥è¿›å…¥å¤´éƒ¨å¤§è„‘çš„æ„è¯†åŒº",
                "è§‚æƒ³è¦æ±‚": "åœ¨è§‚å›¾æ—¶ä¸»è¦æ˜¯èƒ½é‡å°„çº¿çš„ç›´æ¥å¯¼å…¥"
            },
            "ä¿®è¡Œå±‚æ¬¡": {
                "å¹³æ—¶æŒå’’": "æœ‰ç‚¹æ•ˆæœï¼Œä¸»è¦ä¸ºäº†å¹³ä¸‹å¿ƒ",
                "ç¦…ä¸­æŒå’’": "æ•ˆåº”æ‰ä½³ï¼Œè¿™æ˜¯ä½›æ™ºè€…æ‰€ä½œä¹‹å’’çš„ä¸»è¦ç›®çš„",
                "åœ†èå¢ƒç•Œ": "å°å’’å›¾ä¸‰åˆä¸€ï¼Œè¾¾åˆ°åœ†é€šæ™ºæ…§"
            },
            "å®‡å®™èƒ½é‡ç³»ç»Ÿ": self.cosmic_energy_system,
            "ç¦…å®šç­‰çº§ç³»ç»Ÿ": self.meditation_levels,
            "æœ€ç»ˆæˆå°±": "ä¿®ç»ƒåœ†èï¼Œå˜ä¸ºé€‚åº”å®‡å®™å˜åŒ–ï¼Œå³ä¸ç®¡å®‡å®™å¦‚ä½•å˜çš†èƒ½é€‚åº”"
        }
        return theory

# åˆ›å»ºå°å’’å¯†ç³»ç»Ÿå®ä¾‹
mantra_seal_system = MantraSealSystem()

@mantra_seal_bp.route('/meditation-analysis', methods=['POST'])
def meditation_analysis():
    """ç¦…å®šçŠ¶æ€åˆ†æ"""
    try:
        data = request.get_json()
        current_state = data.get('current_state', '')
        
        analysis = mantra_seal_system.analyze_meditation_state(current_state)
        
        return jsonify({
            "status": "success",
            "analysis": analysis,
            "timestamp": datetime.now().isoformat()
        })
    except Exception as e:
        return jsonify({"status": "error", "message": str(e)}), 500

@mantra_seal_bp.route('/practice-plan', methods=['POST'])
def generate_practice_plan():
    """ç”Ÿæˆå°å’’ä¿®è¡Œè®¡åˆ’"""
    try:
        data = request.get_json()
        goal = data.get('goal', '')
        duration = data.get('duration', '30å¤©')
        
        plan = mantra_seal_system.generate_mantra_practice_plan(goal, duration)
        
        return jsonify({
            "status": "success",
            "plan": plan,
            "timestamp": datetime.now().isoformat()
        })
    except Exception as e:
        return jsonify({"status": "error", "message": str(e)}), 500

@mantra_seal_bp.route('/cosmic-sounds-activation', methods=['POST'])
def cosmic_sounds_activation():
    """æ¿€æ´»å®‡å®™åä¸‰éŸ³"""
    try:
        data = request.get_json()
        intention = data.get('intention', '')
        
        activation = mantra_seal_system.activate_cosmic_thirteen_sounds(intention)
        
        return jsonify({
            "status": "success",
            "activation": activation,
            "timestamp": datetime.now().isoformat()
        })
    except Exception as e:
        return jsonify({"status": "error", "message": str(e)}), 500

@mantra_seal_bp.route('/mantra-seals', methods=['GET'])
def get_mantra_seals():
    """è·å–å°å’’ç»„åˆ"""
    try:
        return jsonify({
            "status": "success",
            "mantras": mantra_seal_system.mantras,
            "hand_seals": mantra_seal_system.hand_seals,
            "mantra_diagrams": mantra_seal_system.mantra_diagrams,
            "cosmic_sounds": mantra_seal_system.cosmic_thirteen_sounds,
            "timestamp": datetime.now().isoformat()
        })
    except Exception as e:
        return jsonify({"status": "error", "message": str(e)}), 500

@mantra_seal_bp.route('/complete-theory', methods=['GET'])
def get_complete_theory():
    """è·å–å°å’’å¯†å®Œæ•´ç†è®º"""
    try:
        theory = mantra_seal_system.get_complete_theory()
        
        return jsonify({
            "status": "success",
            "theory": theory,
            "timestamp": datetime.now().isoformat()
        })
    except Exception as e:
        return jsonify({"status": "error", "message": str(e)}), 500

@mantra_seal_bp.route('/energy-system', methods=['GET'])
def get_energy_system():
    """è·å–å®‡å®™èƒ½é‡ç³»ç»Ÿä¿¡æ¯"""
    try:
        return jsonify({
            "status": "success",
            "energy_system": mantra_seal_system.cosmic_energy_system,
            "meditation_levels": mantra_seal_system.meditation_levels,
            "timestamp": datetime.now().isoformat()
        })
    except Exception as e:
        return jsonify({"status": "error", "message": str(e)}), 500