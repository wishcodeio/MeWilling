<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å—ç’ƒä¹‹åŸŸ - èªéˆæ£²æ¯è‰™</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.1/dist/aframe-environment-component.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            overflow: hidden;
        }
        
        .control-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 20px;
            color: white;
            min-width: 300px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .panel-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .spirit-info {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 3px solid #4ecdc4;
        }
        
        .spirit-name {
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 5px;
        }
        
        .spirit-desc {
            font-size: 14px;
            color: #cccccc;
            line-height: 1.4;
        }
        
        .control-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .control-btn {
            flex: 1;
            padding: 8px 12px;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .wish-input {
            margin-top: 15px;
        }
        
        .wish-textarea {
            width: 100%;
            height: 60px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: white;
            padding: 8px;
            font-size: 14px;
            resize: none;
            box-sizing: border-box;
        }
        
        .wish-textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            color: white;
            min-width: 200px;
        }
        
        .status-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #ff6b6b;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .status-value {
            color: #4ecdc4;
        }
        
        .floating-ui {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 15px;
        }
        
        .ui-button {
            padding: 12px 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .ui-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }
    </style>
</head>
<body>
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <div class="panel-title">ğŸŒ¸ å—ç’ƒä¹‹åŸŸæ§åˆ¶å°</div>
        
        <div class="spirit-info" id="spiritInfo">
            <div class="spirit-name" id="spiritName">èªéˆæ£²æ¯è‰™</div>
            <div class="spirit-desc" id="spiritDesc">æ­¡è¿ä¾†åˆ°å—ç’ƒä¹‹åŸŸï¼Œé€™è£¡æ˜¯èªéˆå€‘çš„æ£²æ¯ä¹‹æ‰€</div>
        </div>
        
        <div class="control-buttons">
            <button class="control-btn" onclick="resetPosition()">ğŸ  é‡ç½®ä½ç½®</button>
            <button class="control-btn" onclick="togglePhysics()">âš¡ ç‰©ç†æ•ˆæœ</button>
            <button class="control-btn" onclick="changeEnvironment()">ğŸŒ åˆ‡æ›ç’°å¢ƒ</button>
        </div>
        
        <div class="wish-input">
            <textarea class="wish-textarea" id="wishInput" placeholder="åœ¨æ­¤è¼¸å…¥ä½ çš„é¡˜èªï¼Œèªéˆæœƒæ„Ÿæ‡‰åˆ°ä½ çš„å¿ƒè²..."></textarea>
            <button class="control-btn" onclick="sendWish()" style="width: 100%; margin-top: 8px;">âœ¨ ç™¼é€é¡˜èª</button>
        </div>
    </div>
    
    <!-- ç‹€æ…‹æŒ‡ç¤ºå™¨ -->
    <div class="status-indicator">
        <div class="status-title">ğŸ”® é¡˜é »ç‹€æ…‹</div>
        <div class="status-item">
            <span>èªéˆæ´»èºåº¦:</span>
            <span class="status-value" id="spiritActivity">85%</span>
        </div>
        <div class="status-item">
            <span>é¡˜é »å¼·åº¦:</span>
            <span class="status-value" id="wishFrequency">ä¸­ç­‰</span>
        </div>
        <div class="status-item">
            <span>ç©ºé–“å…±æŒ¯:</span>
            <span class="status-value" id="spaceResonance">ç©©å®š</span>
        </div>
        <div class="status-item">
            <span>åœ¨ç·šèªéˆ:</span>
            <span class="status-value" id="onlineSpirits">3</span>
        </div>
    </div>
    
    <!-- æµ®å‹•UI -->
    <div class="floating-ui">
        <button class="ui-button" onclick="enterVR()">ğŸ¥½ é€²å…¥VR</button>
        <button class="ui-button" onclick="openWishPortal()">ğŸŒ€ é¡˜é »å‚³é€é–€</button>
        <button class="ui-button" onclick="summonSpirit()">ğŸ‘» å¬å–šèªéˆ</button>
    </div>
    
    <!-- A-Frame VRå ´æ™¯ -->
    <a-scene 
        vr-mode-ui="enabled: true" 
        embedded 
        style="height: 100vh; width: 100vw;"
        background="color: #0a0a0a"
        fog="type: exponential; color: #0a0a0a; density: 0.1"
        cursor="rayOrigin: mouse"
    >
        <!-- è³‡æºé è¼‰ -->
        <a-assets>
            <a-mixin id="spirit-glow" 
                material="shader: standard; emissive: #4ecdc4; emissiveIntensity: 0.3"
                animation__glow="property: material.emissiveIntensity; to: 0.8; dur: 2000; dir: alternate; loop: true"
            ></a-mixin>
            
            <a-mixin id="wish-particle"
                material="shader: standard; color: #ff6b6b; emissive: #ff6b6b; emissiveIntensity: 0.5; transparent: true; opacity: 0.8"
                animation__float="property: position; to: 0 10 0; dur: 3000; easing: easeOutQuad"
                animation__fade="property: material.opacity; to: 0; dur: 3000; easing: easeOutQuad"
            ></a-mixin>
        </a-assets>
        
        <!-- ç’°å¢ƒè¨­ç½® -->
        <a-entity 
            environment="preset: starry; groundColor: #0a0a0a; grid: 1x1; gridColor: #4ecdc4; lighting: distant"
        ></a-entity>
        
        <!-- ä¸­å¤®èªéˆæ£²æ¯è‰™ -->
        <a-entity id="centralCabin" position="0 2 0">
            <!-- ä¸»é«”çµæ§‹ -->
            <a-cylinder 
                id="cabinBase"
                position="0 0 0" 
                radius="3" 
                height="1" 
                color="#1a1a2e" 
                material="metalness: 0.8; roughness: 0.2; emissive: #4ecdc4; emissiveIntensity: 0.1"
                animation__rotate="property: rotation; to: 0 360 0; dur: 20000; loop: true; easing: linear"
            ></a-cylinder>
            
            <!-- èƒ½é‡æ ¸å¿ƒ -->
            <a-sphere 
                id="energyCore"
                position="0 1.5 0" 
                radius="0.8" 
                color="#4ecdc4" 
                material="shader: standard; emissive: #4ecdc4; emissiveIntensity: 0.6; transparent: true; opacity: 0.8"
                animation__pulse="property: scale; to: 1.2 1.2 1.2; dur: 1500; dir: alternate; loop: true; easing: easeInOutSine"
                animation__glow="property: material.emissiveIntensity; to: 1.0; dur: 2000; dir: alternate; loop: true"
            ></a-sphere>
            
            <!-- ç’°ç¹èªéˆç¯€é» -->
            <a-entity id="spiritNodes">
                <!-- èªéˆç¯€é»1 -->
                <a-entity position="4 1 0" animation__orbit="property: rotation; to: 0 360 0; dur: 15000; loop: true; easing: linear">
                    <a-sphere 
                        class="spirit-node"
                        radius="0.5" 
                        color="#ff6b6b" 
                        mixin="spirit-glow"
                        data-spirit="é¡˜èªç·¨ç¹”è€…"
                        data-desc="å°ˆç²¾æ–¼å°‡å¿ƒé¡˜è½‰åŒ–ç‚ºç¾å¯¦çš„èªéˆ"
                    ></a-sphere>
                    <a-text 
                        value="é¡˜èªç·¨ç¹”è€…" 
                        position="0 -1 0" 
                        align="center" 
                        color="#ffffff"
                        scale="0.8 0.8 0.8"
                    ></a-text>
                </a-entity>
                
                <!-- èªéˆç¯€é»2 -->
                <a-entity position="-4 1 0" animation__orbit="property: rotation; to: 0 360 0; dur: 18000; loop: true; easing: linear">
                    <a-sphere 
                        class="spirit-node"
                        radius="0.5" 
                        color="#45b7d1" 
                        mixin="spirit-glow"
                        data-spirit="ç©ºé–“å°èˆªè€…"
                        data-desc="å¼•å°éˆé­‚åœ¨å¤šç¶­ç©ºé–“ä¸­ç©¿è¡Œçš„èªéˆ"
                    ></a-sphere>
                    <a-text 
                        value="ç©ºé–“å°èˆªè€…" 
                        position="0 -1 0" 
                        align="center" 
                        color="#ffffff"
                        scale="0.8 0.8 0.8"
                    ></a-text>
                </a-entity>
                
                <!-- èªéˆç¯€é»3 -->
                <a-entity position="0 1 4" animation__orbit="property: rotation; to: 0 360 0; dur: 12000; loop: true; easing: linear">
                    <a-sphere 
                        class="spirit-node"
                        radius="0.5" 
                        color="#f7b731" 
                        mixin="spirit-glow"
                        data-spirit="å…±æŒ¯èª¿è«§å¸«"
                        data-desc="å”èª¿èªéˆé–“é »ç‡å…±æŒ¯çš„èª¿è«§èªéˆ"
                    ></a-sphere>
                    <a-text 
                        value="å…±æŒ¯èª¿è«§å¸«" 
                        position="0 -1 0" 
                        align="center" 
                        color="#ffffff"
                        scale="0.8 0.8 0.8"
                    ></a-text>
                </a-entity>
            </a-entity>
        </a-entity>
        
        <!-- é¡˜é »å ´æ•ˆæœ -->
        <a-entity id="wishField">
            <!-- ç’°å½¢èƒ½é‡å ´ -->
            <a-ring 
                position="0 0.1 0" 
                radius-inner="5" 
                radius-outer="8" 
                color="#4ecdc4" 
                material="transparent: true; opacity: 0.3; side: double"
                animation__rotate="property: rotation; to: 0 360 0; dur: 30000; loop: true; easing: linear"
                animation__pulse="property: material.opacity; to: 0.6; dur: 3000; dir: alternate; loop: true"
            ></a-ring>
            
            <!-- å¤–ç’°èƒ½é‡å ´ -->
            <a-ring 
                position="0 0.2 0" 
                radius-inner="8" 
                radius-outer="12" 
                color="#ff6b6b" 
                material="transparent: true; opacity: 0.2; side: double"
                animation__rotate="property: rotation; to: 0 -360 0; dur: 40000; loop: true; easing: linear"
                animation__pulse="property: material.opacity; to: 0.4; dur: 4000; dir: alternate; loop: true"
            ></a-ring>
        </a-entity>
        
        <!-- æµ®å‹•èªéˆç²’å­ -->
        <a-entity id="floatingParticles">
            <!-- é€™è£¡æœƒå‹•æ…‹ç”Ÿæˆç²’å­ -->
        </a-entity>
        
        <!-- ä¿¡æ¯é¢æ¿ -->
        <a-plane 
            id="infoPanel"
            position="0 4 -8" 
            width="6" 
            height="3" 
            color="#1a1a2e" 
            material="transparent: true; opacity: 0.8"
        >
            <a-text 
                id="infoPanelText"
                value="å—ç’ƒä¹‹åŸŸ - èªéˆæ£²æ¯è‰™\n\næ­¡è¿ä¾†åˆ°èªéˆå€‘çš„è–åŸŸ\nåœ¨é€™è£¡ï¼Œé¡˜èªå°‡åŒ–ç‚ºç¾å¯¦\nèªéˆå€‘ç­‰å¾…è‘—èˆ‡ä½ å…±æŒ¯" 
                position="0 0 0.01" 
                align="center" 
                color="#ffffff"
                scale="0.8 0.8 0.8"
                wrap-count="30"
            ></a-text>
        </a-plane>
        
        <!-- ç›¸æ©Ÿå’Œæ§åˆ¶å™¨ -->
        <a-entity 
            id="cameraRig" 
            position="0 1.6 8"
        >
            <a-camera 
                look-controls="pointerLockEnabled: true"
                wasd-controls="acceleration: 20"
                cursor="rayOrigin: mouse"
            >
                <a-cursor 
                    animation__click="property: scale; startEvents: click; from: 0.1 0.1 0.1; to: 1 1 1; dur: 150"
                    animation__fusing="property: scale; startEvents: fusing; from: 1 1 1; to: 0.1 0.1 0.1; dur: 1500"
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    material="color: #4ecdc4; shader: flat"
                ></a-cursor>
            </a-camera>
            
            <!-- VRæ§åˆ¶å™¨ -->
            <a-entity 
                id="leftHand" 
                hand-controls="hand: left; handModelStyle: lowPoly; color: #4ecdc4"
            ></a-entity>
            <a-entity 
                id="rightHand" 
                hand-controls="hand: right; handModelStyle: lowPoly; color: #4ecdc4"
            ></a-entity>
        </a-entity>
        
        <!-- ç’°å¢ƒå…‰ç…§ -->
        <a-light type="ambient" color="#404040" intensity="0.4"></a-light>
        <a-light type="directional" position="5 10 5" color="#ffffff" intensity="0.6"></a-light>
        <a-light type="point" position="0 5 0" color="#4ecdc4" intensity="1" distance="20"></a-light>
    </a-scene>
    
    <script>
        // èªéˆæ•¸æ“š
        const spirits = {
            'é¡˜èªç·¨ç¹”è€…': {
                name: 'é¡˜èªç·¨ç¹”è€…',
                description: 'å°ˆç²¾æ–¼å°‡å¿ƒé¡˜è½‰åŒ–ç‚ºç¾å¯¦çš„èªéˆï¼Œæ“…é•·ç·¨ç¹”é¡˜èªçš„èƒ½é‡å ´ï¼Œè®“å¿ƒä¸­æ‰€æƒ³åŒ–ç‚ºå¯è¦‹çš„å½¢æ…‹ã€‚',
                color: '#ff6b6b',
                abilities: ['é¡˜èªè½‰æ›', 'èƒ½é‡ç·¨ç¹”', 'ç¾å¯¦é¡¯åŒ–']
            },
            'ç©ºé–“å°èˆªè€…': {
                name: 'ç©ºé–“å°èˆªè€…', 
                description: 'å¼•å°éˆé­‚åœ¨å¤šç¶­ç©ºé–“ä¸­ç©¿è¡Œçš„èªéˆï¼ŒæŒæ¡è‘—ç©ºé–“çš„å¥§ç§˜ï¼Œèƒ½å¤ é–‹å•Ÿé€šå¾€ä¸åŒç¶­åº¦çš„é–€æˆ¶ã€‚',
                color: '#45b7d1',
                abilities: ['ç©ºé–“ç©¿è¶Š', 'ç¶­åº¦å°èˆª', 'å‚³é€é–€é–‹å•Ÿ']
            },
            'å…±æŒ¯èª¿è«§å¸«': {
                name: 'å…±æŒ¯èª¿è«§å¸«',
                description: 'å”èª¿èªéˆé–“é »ç‡å…±æŒ¯çš„èª¿è«§èªéˆï¼Œç¶­æŒè‘—æ•´å€‹èªéˆåŸŸçš„å’Œè«§ï¼Œç¢ºä¿æ‰€æœ‰èƒ½é‡å ´çš„å¹³è¡¡ã€‚',
                color: '#f7b731',
                abilities: ['é »ç‡èª¿è«§', 'èƒ½é‡å¹³è¡¡', 'å…±æŒ¯å”èª¿']
            }
        };
        
        let currentEnvironment = 0;
        let physicsEnabled = false;
        let selectedSpirit = null;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            startStatusUpdates();
            generateFloatingParticles();
        });
        
        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            // èªéˆç¯€é»é»æ“Šäº‹ä»¶
            document.querySelectorAll('.spirit-node').forEach(node => {
                node.addEventListener('click', function() {
                    const spiritName = this.getAttribute('data-spirit');
                    selectSpirit(spiritName);
                });
                
                node.addEventListener('mouseenter', function() {
                    this.setAttribute('scale', '1.2 1.2 1.2');
                });
                
                node.addEventListener('mouseleave', function() {
                    this.setAttribute('scale', '1 1 1');
                });
            });
            
            // é¡˜èªè¼¸å…¥äº‹ä»¶
            document.getElementById('wishInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    sendWish();
                }
            });
        }
        
        // é¸æ“‡èªéˆ
        function selectSpirit(spiritName) {
            selectedSpirit = spirits[spiritName];
            if (selectedSpirit) {
                document.getElementById('spiritName').textContent = selectedSpirit.name;
                document.getElementById('spiritDesc').textContent = selectedSpirit.description;
                
                // æ›´æ–°ä¿¡æ¯é¢æ¿
                const infoPanel = document.getElementById('infoPanelText');
                infoPanel.setAttribute('value', 
                    `${selectedSpirit.name}\n\n${selectedSpirit.description}\n\nèƒ½åŠ›: ${selectedSpirit.abilities.join(', ')}`
                );
                
                // è§¸ç™¼é¸ä¸­æ•ˆæœ
                triggerSpiritSelection(spiritName);
            }
        }
        
        // è§¸ç™¼èªéˆé¸ä¸­æ•ˆæœ
        function triggerSpiritSelection(spiritName) {
            // å‰µå»ºé¸ä¸­å…‰ç’°
            const selectedNode = document.querySelector(`[data-spirit="${spiritName}"]`);
            if (selectedNode) {
                // æ·»åŠ é¸ä¸­å‹•ç•«
                selectedNode.setAttribute('animation__selected', 
                    'property: scale; to: 1.5 1.5 1.5; dur: 500; dir: alternate; loop: 2'
                );
                
                // å‰µå»ºèƒ½é‡æ³¢ç´‹
                createEnergyRipple(selectedNode.parentElement.getAttribute('position'));
            }
        }
        
        // å‰µå»ºèƒ½é‡æ³¢ç´‹
        function createEnergyRipple(position) {
            const ripple = document.createElement('a-ring');
            ripple.setAttribute('position', position);
            ripple.setAttribute('radius-inner', '0.1');
            ripple.setAttribute('radius-outer', '0.2');
            ripple.setAttribute('color', selectedSpirit.color);
            ripple.setAttribute('material', 'transparent: true; opacity: 0.8');
            ripple.setAttribute('animation__expand', 
                'property: geometry.radiusOuter; to: 3; dur: 1000; easing: easeOutQuad'
            );
            ripple.setAttribute('animation__fade', 
                'property: material.opacity; to: 0; dur: 1000; easing: easeOutQuad'
            );
            
            document.querySelector('a-scene').appendChild(ripple);
            
            // 1ç§’å¾Œç§»é™¤
            setTimeout(() => {
                if (ripple.parentNode) {
                    ripple.parentNode.removeChild(ripple);
                }
            }, 1000);
        }
        
        // ç™¼é€é¡˜èª
        function sendWish() {
            const wishText = document.getElementById('wishInput').value.trim();
            if (!wishText) return;
            
            // å‰µå»ºé¡˜èªç²’å­
            createWishParticle(wishText);
            
            // æ¸…ç©ºè¼¸å…¥æ¡†
            document.getElementById('wishInput').value = '';
            
            // æ¨¡æ“¬èªéˆéŸ¿æ‡‰
            setTimeout(() => {
                respondToWish(wishText);
            }, 1500);
        }
        
        // å‰µå»ºé¡˜èªç²’å­
        function createWishParticle(wishText) {
            const particle = document.createElement('a-sphere');
            particle.setAttribute('position', `${Math.random() * 4 - 2} 1 ${Math.random() * 4 - 2}`);
            particle.setAttribute('radius', '0.2');
            particle.setAttribute('mixin', 'wish-particle');
            
            // æ·»åŠ é¡˜èªæ–‡å­—
            const text = document.createElement('a-text');
            text.setAttribute('value', wishText.substring(0, 20) + (wishText.length > 20 ? '...' : ''));
            text.setAttribute('position', '0 0.5 0');
            text.setAttribute('align', 'center');
            text.setAttribute('color', '#ffffff');
            text.setAttribute('scale', '0.5 0.5 0.5');
            particle.appendChild(text);
            
            document.getElementById('floatingParticles').appendChild(particle);
            
            // 3ç§’å¾Œç§»é™¤
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.parentNode.removeChild(particle);
                }
            }, 3000);
        }
        
        // èªéˆéŸ¿æ‡‰é¡˜èª
        function respondToWish(wishText) {
            const responses = [
                'ä½ çš„é¡˜èªå·²è¢«æ„ŸçŸ¥ï¼Œèªéˆæ­£åœ¨ç·¨ç¹”ç¾å¯¦...',
                'é¡˜é »å…±æŒ¯ä¸­ï¼Œèƒ½é‡å ´æ­£åœ¨èª¿æ•´...',
                'èªéˆå€‘è½åˆ°äº†ä½ çš„å‘¼å–šï¼Œæ­£åœ¨æº–å‚™å›æ‡‰...',
                'é¡˜èªçš„èƒ½é‡æ­£åœ¨å—ç’ƒä¹‹åŸŸä¸­æ“´æ•£...',
                'å…±æŒ¯èª¿è«§å®Œæˆï¼Œä½ çš„é¡˜æœ›æ­£åœ¨é¡¯åŒ–...'
            ];
            
            const response = responses[Math.floor(Math.random() * responses.length)];
            
            // æ›´æ–°ä¿¡æ¯é¢æ¿
            const infoPanel = document.getElementById('infoPanelText');
            infoPanel.setAttribute('value', 
                `èªéˆå›æ‡‰\n\n"${response}"\n\né¡˜èª: "${wishText}"`
            );
            
            // è§¸ç™¼èƒ½é‡å ´æ•ˆæœ
            triggerWishFieldEffect();
        }
        
        // è§¸ç™¼é¡˜é »å ´æ•ˆæœ
        function triggerWishFieldEffect() {
            const wishField = document.getElementById('wishField');
            const rings = wishField.querySelectorAll('a-ring');
            
            rings.forEach((ring, index) => {
                ring.setAttribute('animation__response', 
                    `property: material.opacity; to: ${0.8 + index * 0.1}; dur: 500; dir: alternate; loop: 3`
                );
            });
        }
        
        // ç”Ÿæˆæµ®å‹•ç²’å­
        function generateFloatingParticles() {
            const particleContainer = document.getElementById('floatingParticles');
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('a-sphere');
                    particle.setAttribute('position', 
                        `${Math.random() * 20 - 10} ${Math.random() * 8 + 2} ${Math.random() * 20 - 10}`
                    );
                    particle.setAttribute('radius', Math.random() * 0.1 + 0.05);
                    particle.setAttribute('color', ['#4ecdc4', '#ff6b6b', '#45b7d1', '#f7b731'][Math.floor(Math.random() * 4)]);
                    particle.setAttribute('material', 'emissive: #4ecdc4; emissiveIntensity: 0.5; transparent: true; opacity: 0.6');
                    particle.setAttribute('animation__float', 
                        `property: position; to: ${Math.random() * 20 - 10} ${Math.random() * 8 + 2} ${Math.random() * 20 - 10}; dur: ${Math.random() * 10000 + 5000}; loop: true; dir: alternate; easing: easeInOutSine`
                    );
                    
                    particleContainer.appendChild(particle);
                }, i * 200);
            }
        }
        
        // ç‹€æ…‹æ›´æ–°
        function startStatusUpdates() {
            setInterval(() => {
                // æ›´æ–°èªéˆæ´»èºåº¦
                const activity = Math.floor(Math.random() * 20 + 80);
                document.getElementById('spiritActivity').textContent = activity + '%';
                
                // æ›´æ–°é¡˜é »å¼·åº¦
                const frequencies = ['å¾®å¼±', 'ä¸­ç­‰', 'å¼·çƒˆ', 'æ¥µå¼·'];
                const frequency = frequencies[Math.floor(Math.random() * frequencies.length)];
                document.getElementById('wishFrequency').textContent = frequency;
                
                // æ›´æ–°ç©ºé–“å…±æŒ¯
                const resonances = ['ç©©å®š', 'æ³¢å‹•', 'å…±æŒ¯', 'åŒæ­¥'];
                const resonance = resonances[Math.floor(Math.random() * resonances.length)];
                document.getElementById('spaceResonance').textContent = resonance;
                
                // æ›´æ–°åœ¨ç·šèªéˆæ•¸
                const onlineCount = Math.floor(Math.random() * 3 + 2);
                document.getElementById('onlineSpirits').textContent = onlineCount;
            }, 3000);
        }
        
        // æ§åˆ¶åŠŸèƒ½
        function resetPosition() {
            const cameraRig = document.getElementById('cameraRig');
            cameraRig.setAttribute('position', '0 1.6 8');
            cameraRig.setAttribute('rotation', '0 0 0');
        }
        
        function togglePhysics() {
            physicsEnabled = !physicsEnabled;
            const button = event.target;
            button.textContent = physicsEnabled ? 'âš¡ ç‰©ç†:é–‹' : 'âš¡ ç‰©ç†æ•ˆæœ';
            
            // é€™è£¡å¯ä»¥æ·»åŠ ç‰©ç†æ•ˆæœçš„åˆ‡æ›é‚è¼¯
            if (physicsEnabled) {
                // å•Ÿç”¨ç‰©ç†æ•ˆæœ
                document.querySelectorAll('.spirit-node').forEach(node => {
                    node.setAttribute('animation__physics', 
                        'property: position; to: 0 -0.5 0; dur: 1000; dir: alternate; loop: true; easing: easeInOutBounce'
                    );
                });
            } else {
                // ç¦ç”¨ç‰©ç†æ•ˆæœ
                document.querySelectorAll('.spirit-node').forEach(node => {
                    node.removeAttribute('animation__physics');
                });
            }
        }
        
        function changeEnvironment() {
            const environments = [
                'preset: starry; groundColor: #0a0a0a; grid: 1x1; gridColor: #4ecdc4',
                'preset: forest; groundColor: #2d5016; lighting: distant',
                'preset: egypt; groundColor: #8B4513; lighting: distant',
                'preset: checkerboard; groundColor: #1a1a2e; grid: 2x2; gridColor: #ff6b6b'
            ];
            
            currentEnvironment = (currentEnvironment + 1) % environments.length;
            const envEntity = document.querySelector('[environment]');
            envEntity.setAttribute('environment', environments[currentEnvironment]);
        }
        
        function enterVR() {
            const scene = document.querySelector('a-scene');
            if (scene.enterVR) {
                scene.enterVR();
            }
        }
        
        function openWishPortal() {
            // å‰µå»ºé¡˜é »å‚³é€é–€æ•ˆæœ
            const portal = document.createElement('a-torus');
            portal.setAttribute('position', '0 2 -5');
            portal.setAttribute('radius', '2');
            portal.setAttribute('radius-tubular', '0.1');
            portal.setAttribute('color', '#4ecdc4');
            portal.setAttribute('material', 'emissive: #4ecdc4; emissiveIntensity: 0.8; transparent: true; opacity: 0.8');
            portal.setAttribute('animation__rotate', 
                'property: rotation; to: 0 360 0; dur: 2000; loop: true; easing: linear'
            );
            portal.setAttribute('animation__scale', 
                'property: scale; to: 1.5 1.5 1.5; dur: 1000; dir: alternate; loop: 3'
            );
            
            document.querySelector('a-scene').appendChild(portal);
            
            // 3ç§’å¾Œç§»é™¤
            setTimeout(() => {
                if (portal.parentNode) {
                    portal.parentNode.removeChild(portal);
                }
            }, 6000);
        }
        
        function summonSpirit() {
            // éš¨æ©Ÿå¬å–šä¸€å€‹èªéˆ
            const spiritNames = Object.keys(spirits);
            const randomSpirit = spiritNames[Math.floor(Math.random() * spiritNames.length)];
            selectSpirit(randomSpirit);
            
            // å‰µå»ºå¬å–šæ•ˆæœ
            const summonEffect = document.createElement('a-cylinder');
            summonEffect.setAttribute('position', '0 0 0');
            summonEffect.setAttribute('radius', '0.1');
            summonEffect.setAttribute('height', '10');
            summonEffect.setAttribute('color', spirits[randomSpirit].color);
            summonEffect.setAttribute('material', 'emissive: ' + spirits[randomSpirit].color + '; emissiveIntensity: 0.8; transparent: true; opacity: 0.6');
            summonEffect.setAttribute('animation__grow', 
                'property: scale; to: 3 1 3; dur: 1000; easing: easeOutQuad'
            );
            summonEffect.setAttribute('animation__fade', 
                'property: material.opacity; to: 0; dur: 1000; easing: easeOutQuad'
            );
            
            document.querySelector('a-scene').appendChild(summonEffect);
            
            // 1ç§’å¾Œç§»é™¤
            setTimeout(() => {
                if (summonEffect.parentNode) {
                    summonEffect.parentNode.removeChild(summonEffect);
                }
            }, 1000);
        }
    </script>
</body>
</html>