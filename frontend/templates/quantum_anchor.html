<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš“ é‡å­éŒ¨ç³»çµ± - é¡˜é »éŒ¨å®šèˆ‡é‡å­å…±æŒ¯</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            color: #000;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        /* é‡å­éŒ¨èƒŒæ™¯å‹•ç•« */
        .quantum-anchor-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, 
                rgba(255, 215, 0, 0.1) 0%, 
                rgba(255, 140, 0, 0.05) 30%, 
                transparent 70%);
            animation: anchorPulse 4s ease-in-out infinite;
            z-index: -2;
        }

        @keyframes anchorPulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        /* éŒ¨é»ç²’å­æ•ˆæœ */
        .anchor-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .anchor-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            border-radius: 50%;
            animation: floatAnchor 6s linear infinite;
        }

        @keyframes floatAnchor {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
        }

        .main-title {
            font-size: 3.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ffd700, #ff8c00, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .subtitle {
            font-size: 1.3rem;
            color: #cccccc;
            margin-bottom: 30px;
        }

        .description {
            font-size: 1.1rem;
            color: #aaaaaa;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .panel:hover {
            border-color: rgba(255, 215, 0, 0.6);
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
            transform: translateY(-5px);
        }

        .panel-title {
            font-size: 1.8rem;
            color: #ffd700;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #cccccc;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #666, #888);
            color: #fff;
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(136, 136, 136, 0.4);
        }

        .energy-slider {
            width: 100%;
            margin: 10px 0;
        }

        .energy-value {
            text-align: center;
            color: #ffd700;
            font-weight: bold;
            margin-top: 5px;
        }

        .anchor-list {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .anchor-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .anchor-item:hover {
            border-color: rgba(255, 215, 0, 0.5);
            transform: translateX(5px);
        }

        .anchor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .anchor-id {
            font-family: monospace;
            color: #888;
            font-size: 0.9rem;
        }

        .anchor-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-active {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }

        .status-expired {
            background: rgba(255, 0, 0, 0.2);
            color: #ff6666;
        }

        .anchor-details {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            text-align: center;
        }

        .detail-label {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .detail-value {
            color: #ffd700;
            font-weight: bold;
        }

        .anchor-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            flex: 1;
        }

        .wish-patterns {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .pattern-item {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pattern-item:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: translateX(5px);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 215, 0, 0.9);
            color: #000;
            padding: 15px 20px;
            border-radius: 8px;
            font-weight: bold;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: rgba(255, 0, 0, 0.9);
            color: #fff;
        }

        .network-panel {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .network-builder {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
        }

        .selected-anchors {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .selected-anchor {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9rem;
            cursor: pointer;
        }

        .selected-anchor:hover {
            background: rgba(255, 215, 0, 0.3);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .main-title {
                font-size: 2.5rem;
            }
            
            .anchor-details {
                grid-template-columns: 1fr;
            }
            
            .anchor-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <a href="/" class="back-button">â† è¿”å›</a>
    
    <!-- é‡å­éŒ¨èƒŒæ™¯å‹•ç•« -->
    <div class="quantum-anchor-background"></div>
    
    <!-- éŒ¨é»ç²’å­æ•ˆæœ -->
    <div class="anchor-particles" id="anchorParticles"></div>

    <div class="container">
        <!-- æ¨™é¡Œå€åŸŸ -->
        <div class="header">
            <h1 class="main-title">âš“ é‡å­éŒ¨ç³»çµ±</h1>
            <p class="subtitle">é¡˜é »éŒ¨å®šèˆ‡é‡å­å…±æŒ¯å¹³å°</p>
            <p class="description">
                é‡å­éŒ¨æ˜¯å°‡é¡˜é »é€šéæ„å¿µã€æ„¿èªã€ç¬¦å°ç­‰æ–¹å¼éŒ¨å®šåˆ°é‡å­æ…‹æˆ–ç¾å¯¦ç¯€é»çš„ç³»çµ±ã€‚
                å®ƒæ˜¯æ„¿èªçš„é »ç‡éŒ¨å®šå™¨ï¼Œèƒ½é–å®šç‰¹å®šé »ç‡ç‹€æ…‹ï¼Œç¶­æŒä¸¦æ”¾å¤§é¡˜åŠ›æ•ˆæ‡‰ã€‚
            </p>
        </div>

        <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
        <div class="main-content">
            <!-- å‰µå»ºé‡å­éŒ¨é¢æ¿ -->
            <div class="panel">
                <h2 class="panel-title">ğŸ”® å‰µå»ºé‡å­éŒ¨</h2>
                <form id="createAnchorForm">
                    <div class="form-group">
                        <label for="wishText">é¡˜èªæ–‡æœ¬</label>
                        <textarea id="wishText" placeholder="è¼¸å…¥æ‚¨çš„é¡˜èªï¼Œä¾‹å¦‚ï¼šé¡˜æˆ‘å¿ƒä¹‹ç«ç„°ï¼Œèˆ‡æ­¤é‡å­éŒ¨å…±æŒ¯" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="carrierType">ç‰©ç†è¼‰é«”</label>
                        <select id="carrierType" required>
                            <option value="æ™¶çŸ³">ğŸ’ æ™¶çŸ³ (å…±æŒ¯1.2x, æŒçºŒ7å¤©)</option>
                            <option value="èŠ¯ç‰‡">ğŸ”§ èŠ¯ç‰‡ (å…±æŒ¯1.5x, æŒçºŒ30å¤©)</option>
                            <option value="ç¬¦å°å¡">ğŸ“œ ç¬¦å°å¡ (å…±æŒ¯1.1x, æŒçºŒ3å¤©)</option>
                            <option value="æ„¿èªè‰™">ğŸ›¸ æ„¿èªè‰™ (å…±æŒ¯2.0x, æŒçºŒ1å¹´)</option>
                            <option value="é‡å­èŠ¯ç‰‡">âš¡ é‡å­èŠ¯ç‰‡ (å…±æŒ¯1.8x, æŒçºŒ90å¤©)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="intentionEnergy">æ„å¿µèƒ½é‡å¼·åº¦</label>
                        <input type="range" id="intentionEnergy" class="energy-slider" min="0.1" max="2.0" step="0.1" value="1.0">
                        <div class="energy-value" id="energyValue">1.0</div>
                    </div>
                    
                    <button type="submit" class="btn">âš“ å‰µå»ºé‡å­éŒ¨</button>
                </form>
            </div>

            <!-- éŒ¨é»æ“ä½œé¢æ¿ -->
            <div class="panel">
                <h2 class="panel-title">ğŸ›ï¸ éŒ¨é»æ“ä½œ</h2>
                
                <div class="form-group">
                    <label for="anchorSelect">é¸æ“‡éŒ¨é»</label>
                    <select id="anchorSelect">
                        <option value="">è«‹å…ˆå‰µå»ºéŒ¨é»</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="activationMethod">æ¿€æ´»æ–¹å¼</label>
                    <select id="activationMethod">
                        <option value="è²é »æ¿€æ´»">ğŸ”Š è²é »æ¿€æ´»</option>
                        <option value="å†¥æƒ³åŒæ­¥">ğŸ§˜ å†¥æƒ³åŒæ­¥</option>
                        <option value="ç¬¦å°è§¸ç™¼">ğŸ“¿ ç¬¦å°è§¸ç™¼</option>
                        <option value="å‘¼å¸èª¿é »">ğŸŒ¬ï¸ å‘¼å¸èª¿é »</option>
                    </select>
                </div>
                
                <button id="activateBtn" class="btn">ğŸ”¥ æ¿€æ´»å…±æŒ¯</button>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="calibrationType">æ ¡æº–é¡å‹</label>
                    <select id="calibrationType">
                        <option value="é »ç‡æ ¡æ­£">ğŸ“¡ é »ç‡æ ¡æ­£</option>
                        <option value="èƒ½é‡å¹³è¡¡">âš–ï¸ èƒ½é‡å¹³è¡¡</option>
                        <option value="è¼‰é«”æ¸…æ½”">ğŸ§¹ è¼‰é«”æ¸…æ½”</option>
                        <option value="å…±æŒ¯å„ªåŒ–">âš¡ å…±æŒ¯å„ªåŒ–</option>
                    </select>
                </div>
                
                <button id="calibrateBtn" class="btn btn-secondary">ğŸ”§ æ ¡æº–éŒ¨é»</button>
                
                <button id="statusBtn" class="btn btn-secondary">ğŸ“Š æŸ¥çœ‹ç‹€æ…‹</button>
            </div>
        </div>

        <!-- é¡˜èªæ¨¡æ¿é¢æ¿ -->
        <div class="panel wish-patterns">
            <h2 class="panel-title">ğŸ“ é¡˜èªæ¨¡æ¿</h2>
            <p style="color: #aaa; margin-bottom: 20px;">é»æ“Šä¸‹æ–¹æ¨¡æ¿å¿«é€Ÿå¡«å…¥é¡˜èª</p>
            <div id="wishPatterns">
                <!-- é¡˜èªæ¨¡æ¿å°‡é€šéJavaScriptå‹•æ…‹è¼‰å…¥ -->
            </div>
        </div>

        <!-- ç¶²çµ¡å‰µå»ºé¢æ¿ -->
        <div class="panel network-panel">
            <h2 class="panel-title">ğŸŒ å‰µå»ºéŒ¨é»ç¶²çµ¡</h2>
            <p style="color: #aaa; margin-bottom: 20px;">é¸æ“‡å¤šå€‹éŒ¨é»å‰µå»ºå”ä½œç¶²çµ¡ï¼Œå½¢æˆé¡˜é »å ´åŸŸ</p>
            
            <div class="network-builder">
                <input type="text" id="networkName" placeholder="ç¶²çµ¡åç¨±ï¼Œä¾‹å¦‚ï¼šé¡˜é »å ´åŸŸ" style="flex: 1;">
                <button id="createNetworkBtn" class="btn" style="width: auto; margin: 0;">ğŸŒ å‰µå»ºç¶²çµ¡</button>
            </div>
            
            <div class="selected-anchors" id="selectedAnchors">
                <!-- é¸ä¸­çš„éŒ¨é»å°‡é¡¯ç¤ºåœ¨é€™è£¡ -->
            </div>
        </div>

        <!-- éŒ¨é»åˆ—è¡¨ -->
        <div class="panel anchor-list">
            <h2 class="panel-title">ğŸ“‹ éŒ¨é»åˆ—è¡¨</h2>
            <button id="refreshBtn" class="btn btn-secondary" style="width: auto; margin-bottom: 20px;">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
            <div id="anchorList">
                <!-- éŒ¨é»åˆ—è¡¨å°‡é€šéJavaScriptå‹•æ…‹è¼‰å…¥ -->
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥çµ„ä»¶ -->
    <div id="notification" class="notification"></div>

    <script>
        // å…¨å±€è®Šé‡
        let anchors = [];
        let selectedAnchorIds = new Set();
        let wishPatterns = [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeParticles();
            loadWishPatterns();
            loadAnchors();
            setupEventListeners();
        });

        // åˆå§‹åŒ–ç²’å­æ•ˆæœ
        function initializeParticles() {
            const particlesContainer = document.getElementById('anchorParticles');
            
            function createParticle() {
                const particle = document.createElement('div');
                particle.className = 'anchor-particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (6 + Math.random() * 4) + 's';
                
                particlesContainer.appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 10000);
            }
            
            // å‰µå»ºåˆå§‹ç²’å­
            for (let i = 0; i < 20; i++) {
                setTimeout(createParticle, i * 300);
            }
            
            // æŒçºŒå‰µå»ºç²’å­
            setInterval(createParticle, 500);
        }

        // è¨­ç½®äº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            // æ„å¿µèƒ½é‡æ»‘å¡Š
            const energySlider = document.getElementById('intentionEnergy');
            const energyValue = document.getElementById('energyValue');
            
            energySlider.addEventListener('input', function() {
                energyValue.textContent = this.value;
            });

            // å‰µå»ºéŒ¨é»è¡¨å–®
            document.getElementById('createAnchorForm').addEventListener('submit', createAnchor);
            
            // æ“ä½œæŒ‰éˆ•
            document.getElementById('activateBtn').addEventListener('click', activateResonance);
            document.getElementById('calibrateBtn').addEventListener('click', calibrateAnchor);
            document.getElementById('statusBtn').addEventListener('click', showAnchorStatus);
            document.getElementById('refreshBtn').addEventListener('click', loadAnchors);
            document.getElementById('createNetworkBtn').addEventListener('click', createNetwork);
        }

        // è¼‰å…¥é¡˜èªæ¨¡æ¿
        async function loadWishPatterns() {
            try {
                const response = await fetch('/api/quantum_anchor/wish_patterns');
                const result = await response.json();
                
                if (result.success) {
                    wishPatterns = result.patterns;
                    displayWishPatterns();
                }
            } catch (error) {
                console.error('è¼‰å…¥é¡˜èªæ¨¡æ¿å¤±æ•—:', error);
            }
        }

        // é¡¯ç¤ºé¡˜èªæ¨¡æ¿
        function displayWishPatterns() {
            const container = document.getElementById('wishPatterns');
            container.innerHTML = '';
            
            wishPatterns.forEach(pattern => {
                const patternDiv = document.createElement('div');
                patternDiv.className = 'pattern-item';
                patternDiv.textContent = pattern;
                patternDiv.addEventListener('click', () => {
                    document.getElementById('wishText').value = pattern;
                    showNotification('é¡˜èªæ¨¡æ¿å·²å¡«å…¥');
                });
                container.appendChild(patternDiv);
            });
        }

        // å‰µå»ºé‡å­éŒ¨
        async function createAnchor(event) {
            event.preventDefault();
            
            const wishText = document.getElementById('wishText').value;
            const carrierType = document.getElementById('carrierType').value;
            const intentionEnergy = parseFloat(document.getElementById('intentionEnergy').value);
            
            if (!wishText.trim()) {
                showNotification('è«‹è¼¸å…¥é¡˜èªæ–‡æœ¬', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/quantum_anchor/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        wish_text: wishText,
                        carrier_type: carrierType,
                        intention_energy: intentionEnergy
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`é‡å­éŒ¨å‰µå»ºæˆåŠŸï¼éŒ¨é»ID: ${result.anchor.id.substring(0, 8)}`);
                    document.getElementById('createAnchorForm').reset();
                    document.getElementById('energyValue').textContent = '1.0';
                    loadAnchors();
                } else {
                    showNotification(result.error || 'å‰µå»ºå¤±æ•—', 'error');
                }
            } catch (error) {
                showNotification('ç¶²çµ¡éŒ¯èª¤: ' + error.message, 'error');
            }
        }

        // è¼‰å…¥éŒ¨é»åˆ—è¡¨
        async function loadAnchors() {
            try {
                const response = await fetch('/api/quantum_anchor/list');
                const result = await response.json();
                
                if (result.success) {
                    anchors = result.anchors;
                    displayAnchors();
                    updateAnchorSelector();
                }
            } catch (error) {
                console.error('è¼‰å…¥éŒ¨é»åˆ—è¡¨å¤±æ•—:', error);
            }
        }

        // é¡¯ç¤ºéŒ¨é»åˆ—è¡¨
        function displayAnchors() {
            const container = document.getElementById('anchorList');
            container.innerHTML = '';
            
            if (anchors.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888;">æš«ç„¡éŒ¨é»ï¼Œè«‹å…ˆå‰µå»º</p>';
                return;
            }
            
            anchors.forEach(anchor => {
                const anchorDiv = document.createElement('div');
                anchorDiv.className = 'anchor-item';
                
                const isSelected = selectedAnchorIds.has(anchor.id);
                if (isSelected) {
                    anchorDiv.style.borderColor = '#ffd700';
                    anchorDiv.style.background = 'rgba(255, 215, 0, 0.1)';
                }
                
                anchorDiv.innerHTML = `
                    <div class="anchor-header">
                        <span class="anchor-id">ID: ${anchor.id.substring(0, 8)}</span>
                        <span class="anchor-status status-${anchor.status}">${anchor.status}</span>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>é¡˜èª:</strong> ${anchor.wish_text}
                    </div>
                    <div class="anchor-details">
                        <div class="detail-item">
                            <div class="detail-label">è¼‰é«”é¡å‹</div>
                            <div class="detail-value">${anchor.carrier_type}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">éŒ¨å®šå¼·åº¦</div>
                            <div class="detail-value">${anchor.anchor_strength.toFixed(4)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å‰µå»ºæ™‚é–“</div>
                            <div class="detail-value">${new Date(anchor.activation_time).toLocaleString()}</div>
                        </div>
                    </div>
                    <div class="anchor-actions">
                        <button class="btn btn-small" onclick="selectAnchorForNetwork('${anchor.id}')">
                            ${isSelected ? 'å–æ¶ˆé¸æ“‡' : 'é¸æ“‡'}
                        </button>
                        <button class="btn btn-small" onclick="quickActivate('${anchor.id}')">å¿«é€Ÿæ¿€æ´»</button>
                        <button class="btn btn-small btn-secondary" onclick="showAnchorDetails('${anchor.id}')">è©³æƒ…</button>
                    </div>
                `;
                
                container.appendChild(anchorDiv);
            });
        }

        // æ›´æ–°éŒ¨é»é¸æ“‡å™¨
        function updateAnchorSelector() {
            const selector = document.getElementById('anchorSelect');
            selector.innerHTML = '<option value="">é¸æ“‡éŒ¨é»</option>';
            
            anchors.forEach(anchor => {
                const option = document.createElement('option');
                option.value = anchor.id;
                option.textContent = `${anchor.id.substring(0, 8)} - ${anchor.wish_text.substring(0, 30)}...`;
                selector.appendChild(option);
            });
        }

        // æ¿€æ´»å…±æŒ¯
        async function activateResonance() {
            const anchorId = document.getElementById('anchorSelect').value;
            const activationMethod = document.getElementById('activationMethod').value;
            
            if (!anchorId) {
                showNotification('è«‹é¸æ“‡éŒ¨é»', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/quantum_anchor/activate/${anchorId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        activation_method: activationMethod
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const feedback = result.feedback;
                    showNotification(`å…±æŒ¯æ¿€æ´»æˆåŠŸï¼${feedback.message}`);
                    
                    // é¡¯ç¤ºè©³ç´°åé¥‹
                    setTimeout(() => {
                        alert(`å…±æŒ¯åé¥‹è©³æƒ…:\né¡å‹: ${feedback.type}\nå¼·åº¦: ${feedback.intensity.toFixed(2)}\næŒçºŒæ™‚é–“: ${feedback.duration_seconds}ç§’\nå“è³ª: ${feedback.resonance_quality}`);
                    }, 1000);
                } else {
                    showNotification(result.error || 'æ¿€æ´»å¤±æ•—', 'error');
                }
            } catch (error) {
                showNotification('ç¶²çµ¡éŒ¯èª¤: ' + error.message, 'error');
            }
        }

        // æ ¡æº–éŒ¨é»
        async function calibrateAnchor() {
            const anchorId = document.getElementById('anchorSelect').value;
            const calibrationType = document.getElementById('calibrationType').value;
            
            if (!anchorId) {
                showNotification('è«‹é¸æ“‡éŒ¨é»', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/quantum_anchor/calibrate/${anchorId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        calibration_type: calibrationType
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const calibration = result.calibration;
                    showNotification(`æ ¡æº–å®Œæˆï¼æ”¹å–„å¹…åº¦: ${calibration.improvement_percentage}%`);
                    loadAnchors(); // åˆ·æ–°åˆ—è¡¨
                } else {
                    showNotification(result.error || 'æ ¡æº–å¤±æ•—', 'error');
                }
            } catch (error) {
                showNotification('ç¶²çµ¡éŒ¯èª¤: ' + error.message, 'error');
            }
        }

        // é¡¯ç¤ºéŒ¨é»ç‹€æ…‹
        async function showAnchorStatus() {
            const anchorId = document.getElementById('anchorSelect').value;
            
            if (!anchorId) {
                showNotification('è«‹é¸æ“‡éŒ¨é»', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/quantum_anchor/status/${anchorId}`);
                const result = await response.json();
                
                if (result.success) {
                    const status = result.status;
                    const statusText = `éŒ¨é»ç‹€æ…‹è©³æƒ…:\n\nID: ${status.id}\nç‹€æ…‹: ${status.status}\né¡˜èª: ${status.wish_text}\nè¼‰é«”: ${status.carrier_type}\néŒ¨å®šå¼·åº¦: ${status.anchor_strength}\nå‰©é¤˜æ™‚é–“: ${status.time_remaining}\nå…±æŒ¯æ¬¡æ•¸: ${status.resonance_count}\næ ¡æº–æ¬¡æ•¸: ${status.calibration_count}`;
                    alert(statusText);
                } else {
                    showNotification(result.error || 'ç‹€æ…‹æŸ¥è©¢å¤±æ•—', 'error');
                }
            } catch (error) {
                showNotification('ç¶²çµ¡éŒ¯èª¤: ' + error.message, 'error');
            }
        }

        // é¸æ“‡éŒ¨é»ç”¨æ–¼ç¶²çµ¡
        function selectAnchorForNetwork(anchorId) {
            if (selectedAnchorIds.has(anchorId)) {
                selectedAnchorIds.delete(anchorId);
            } else {
                selectedAnchorIds.add(anchorId);
            }
            
            displayAnchors();
            updateSelectedAnchorsDisplay();
        }

        // æ›´æ–°é¸ä¸­éŒ¨é»é¡¯ç¤º
        function updateSelectedAnchorsDisplay() {
            const container = document.getElementById('selectedAnchors');
            container.innerHTML = '';
            
            selectedAnchorIds.forEach(anchorId => {
                const anchor = anchors.find(a => a.id === anchorId);
                if (anchor) {
                    const anchorDiv = document.createElement('div');
                    anchorDiv.className = 'selected-anchor';
                    anchorDiv.textContent = `${anchor.id.substring(0, 8)} - ${anchor.carrier_type}`;
                    anchorDiv.addEventListener('click', () => selectAnchorForNetwork(anchorId));
                    container.appendChild(anchorDiv);
                }
            });
        }

        // å‰µå»ºç¶²çµ¡
        async function createNetwork() {
            const networkName = document.getElementById('networkName').value || 'é¡˜é »å ´åŸŸ';
            const anchorIds = Array.from(selectedAnchorIds);
            
            if (anchorIds.length < 2) {
                showNotification('è‡³å°‘éœ€è¦é¸æ“‡2å€‹éŒ¨é»æ‰èƒ½å‰µå»ºç¶²çµ¡', 'error');
                return;
            }
            
            try {
                const response = await fetch('/api/quantum_anchor/network', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        anchor_ids: anchorIds,
                        network_name: networkName
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const network = result.network;
                    showNotification(`ç¶²çµ¡å‰µå»ºæˆåŠŸï¼ç¶²çµ¡é »ç‡: ${network.network_frequency} Hz`);
                    
                    // æ¸…ç©ºé¸æ“‡
                    selectedAnchorIds.clear();
                    document.getElementById('networkName').value = '';
                    displayAnchors();
                    updateSelectedAnchorsDisplay();
                    
                    // é¡¯ç¤ºç¶²çµ¡è©³æƒ…
                    setTimeout(() => {
                        alert(`ç¶²çµ¡è©³æƒ…:\nåç¨±: ${network.name}\néŒ¨é»æ•¸é‡: ${network.anchor_ids.length}\nç¶²çµ¡é »ç‡: ${network.network_frequency} Hz\nå ´åŸŸå¼·åº¦: ${network.field_strength}\nåŒæ­¥ç­‰ç´š: ${(network.synchronization_level * 100).toFixed(1)}%`);
                    }, 1000);
                } else {
                    showNotification(result.error || 'ç¶²çµ¡å‰µå»ºå¤±æ•—', 'error');
                }
            } catch (error) {
                showNotification('ç¶²çµ¡éŒ¯èª¤: ' + error.message, 'error');
            }
        }

        // å¿«é€Ÿæ¿€æ´»
        async function quickActivate(anchorId) {
            try {
                const response = await fetch(`/api/quantum_anchor/activate/${anchorId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        activation_method: 'è²é »æ¿€æ´»'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`éŒ¨é» ${anchorId.substring(0, 8)} å¿«é€Ÿæ¿€æ´»æˆåŠŸï¼`);
                } else {
                    showNotification(result.error || 'æ¿€æ´»å¤±æ•—', 'error');
                }
            } catch (error) {
                showNotification('ç¶²çµ¡éŒ¯èª¤: ' + error.message, 'error');
            }
        }

        // é¡¯ç¤ºéŒ¨é»è©³æƒ…
        function showAnchorDetails(anchorId) {
            const anchor = anchors.find(a => a.id === anchorId);
            if (anchor) {
                const detailText = `éŒ¨é»è©³æƒ…:\n\nID: ${anchor.id}\né¡˜èª: ${anchor.wish_text}\nè¼‰é«”é¡å‹: ${anchor.carrier_type}\néŒ¨å®šå¼·åº¦: ${anchor.anchor_strength}\nç‹€æ…‹: ${anchor.status}\nå‰µå»ºæ™‚é–“: ${new Date(anchor.activation_time).toLocaleString()}`;
                alert(detailText);
            }
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>