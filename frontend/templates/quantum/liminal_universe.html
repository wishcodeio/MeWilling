<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç’ƒå†¥å®‡å®™ - é‡å­é“åœº</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(45deg, #0a0a0a, #1a1a2e, #16213e);
            color: #ffffff;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            height: 100vh;
        }
        
        .universe-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            perspective: 1000px;
        }
        
        .quantum-field {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, 
                rgba(138, 43, 226, 0.3) 0%,
                rgba(75, 0, 130, 0.2) 30%,
                rgba(25, 25, 112, 0.1) 60%,
                rgba(0, 0, 0, 0.8) 100%);
            animation: quantumPulse 4s ease-in-out infinite;
        }
        
        @keyframes quantumPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.05) rotate(1deg); }
        }
        
        .dao-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, 
                #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, 
                #feca57, #ff9ff3, #54a0ff, #5f27cd);
            animation: daoRotation 10s linear infinite;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 50px rgba(255, 255, 255, 0.3);
        }
        
        @keyframes daoRotation {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .taiji-symbol {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(90deg, #000 50%, #fff 50%);
            position: relative;
            animation: taijiSpin 8s linear infinite reverse;
        }
        
        .taiji-symbol::before,
        .taiji-symbol::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
        }
        
        .taiji-symbol::before {
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            box-shadow: inset 0 0 0 15px #000;
        }
        
        .taiji-symbol::after {
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            background: #000;
            box-shadow: inset 0 0 0 15px #fff;
        }
        
        @keyframes taijiSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .nine-departments {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 700px;
            height: 700px;
        }
        
        .department-node {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid #00ffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.4s ease;
            animation: deptGlow 4s ease-in-out infinite;
            backdrop-filter: blur(10px);
            z-index: 100;
            user-select: none;
        }
        
        .central-dao {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.3), rgba(255, 255, 255, 0.1));
            border: 3px solid #ffd700;
            animation: centralPulse 3s ease-in-out infinite;
            z-index: 150;
            user-select: none;
        }
        
        .dept-symbol {
            font-size: 28px;
            margin-bottom: 5px;
            filter: drop-shadow(0 0 5px currentColor);
        }
        
        .dept-name {
            font-size: 12px;
            font-weight: bold;
            color: #00ffff;
            text-align: center;
            text-shadow: 0 0 5px currentColor;
        }
        
        .central-dao .dept-symbol {
            font-size: 36px;
            color: #ffd700;
        }
        
        .central-dao .dept-name {
            color: #ffd700;
            font-size: 14px;
        }
        
        .department-node:hover {
            transform: scale(1.15) rotate(5deg);
            box-shadow: 0 0 40px currentColor;
            background: rgba(0, 255, 255, 0.3);
        }
        
        .central-dao:hover {
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 0 0 50px #ffd700;
        }
        
        @keyframes deptGlow {
            0%, 100% { box-shadow: 0 0 15px #00ffff; }
            50% { box-shadow: 0 0 30px #00ffff, 0 0 45px #00ffff; }
        }
        
        @keyframes centralPulse {
            0%, 100% { box-shadow: 0 0 20px #ffd700; }
            50% { box-shadow: 0 0 40px #ffd700, 0 0 60px #ffd700; }
        }
        
        /* ä¹éƒ¨å¸å®Œç¾åœ“å½¢ä½ˆå±€ - ä»¥ä¸­å¿ƒç‚ºåœ“å¿ƒï¼ŒåŠå¾‘300pxçš„åœ“å½¢æ’åˆ— */
        .department-node[data-index="1"] { 
            top: calc(50% - 300px * 0.866); /* é ‚éƒ¨ - 60åº¦ */
            left: calc(50% - 300px * 0.5); 
            transform: translate(-50%, -50%); 
        }
        .department-node[data-index="2"] { 
            top: calc(50% - 300px * 0.866); /* é ‚éƒ¨å³ - 120åº¦ */
            left: calc(50% + 300px * 0.5); 
            transform: translate(-50%, -50%); 
        }
        .department-node[data-index="3"] { 
            top: 50%; /* å³å´ - 0åº¦ */
            left: calc(50% + 300px); 
            transform: translate(-50%, -50%); 
        }
        .department-node[data-index="4"] { 
            top: calc(50% + 300px * 0.866); /* åº•éƒ¨å³ - 300åº¦ */
            left: calc(50% + 300px * 0.5); 
            transform: translate(-50%, -50%); 
        }
        .department-node[data-index="5"] { 
            top: calc(50% + 300px * 0.866); /* åº•éƒ¨å·¦ - 240åº¦ */
            left: calc(50% - 300px * 0.5); 
            transform: translate(-50%, -50%); 
        }
        .department-node[data-index="6"] { 
            top: 50%; /* å·¦å´ - 180åº¦ */
            left: calc(50% - 300px); 
            transform: translate(-50%, -50%); 
        }
        .department-node[data-index="7"] { 
            top: calc(50% - 300px * 0.5); /* å·¦ä¸Š - 135åº¦ */
            left: calc(50% - 300px * 0.707); 
            transform: translate(-50%, -50%); 
        }
        .department-node[data-index="8"] { 
            top: calc(50% - 300px * 0.5); /* å³ä¸Š - 45åº¦ */
            left: calc(50% + 300px * 0.707); 
            transform: translate(-50%, -50%); 
        }
        .department-node[data-index="9"] { 
            top: calc(50% + 300px * 0.5); /* åº•éƒ¨ä¸­å¿ƒ - 270åº¦ */
            left: 50%; 
            transform: translate(-50%, -50%); 
        }
        
        /* éƒ¨å¸ç‰¹è‰²é¡è‰² */
        .department-node[data-index="1"] { border-color: #ff6b6b; color: #ff6b6b; }
        .department-node[data-index="2"] { border-color: #4ecdc4; color: #4ecdc4; }
        .department-node[data-index="3"] { border-color: #45b7d1; color: #45b7d1; }
        .department-node[data-index="4"] { border-color: #96ceb4; color: #96ceb4; }
        .department-node[data-index="5"] { border-color: #feca57; color: #feca57; }
        .department-node[data-index="6"] { border-color: #ff9ff3; color: #ff9ff3; }
        .department-node[data-index="7"] { border-color: #54a0ff; color: #54a0ff; }
        .department-node[data-index="8"] { border-color: #5f27cd; color: #5f27cd; }
        .department-node[data-index="9"] { border-color: #00d2d3; color: #00d2d3; }
        
        .quantum-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffffff;
            border-radius: 50%;
            animation: particleFloat 6s linear infinite;
        }
        
        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-10vh) translateX(100px);
                opacity: 0;
            }
        }
        
        .control-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00ffff;
            border-radius: 10px;
            padding: 20px;
            min-width: 320px;
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        
        .department-info {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid #ffd700;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        #selected-dept {
            color: #ffd700;
            font-weight: bold;
        }
        
        #dept-description {
             color: #ffffff;
             font-style: italic;
             margin-top: 5px;
             display: block;
         }
        
        .control-panel h3 {
            color: #00ffff;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .status-value {
            color: #00ff00;
            font-weight: bold;
        }
        
        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .control-btn {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            z-index: 1001;
            position: relative;
            user-select: none;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        @keyframes rainbow {
            0% { background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1); }
            25% { background: linear-gradient(45deg, #4ecdc4, #45b7d1, #96ceb4); }
            50% { background: linear-gradient(45deg, #45b7d1, #96ceb4, #feca57); }
            75% { background: linear-gradient(45deg, #96ceb4, #feca57, #ff9ff3); }
            100% { background: linear-gradient(45deg, #feca57, #ff9ff3, #ff6b6b); }
        }
        
        .quantum-display {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ff6b6b;
            border-radius: 10px;
            padding: 15px;
            min-width: 250px;
            backdrop-filter: blur(10px);
        }
        
        .quantum-display h4 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        
        .quantum-value {
            font-size: 24px;
            font-weight: bold;
            color: #00ff00;
            text-align: center;
            margin: 10px 0;
        }
        
        .divination-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #feca57;
            border-radius: 10px;
            padding: 15px;
            min-width: 300px;
            backdrop-filter: blur(10px);
        }
        
        .divination-input {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #feca57;
            border-radius: 5px;
            color: white;
            margin-bottom: 10px;
        }
        
        .divination-result {
            background: rgba(254, 202, 87, 0.1);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            min-height: 60px;
            color: #feca57;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 12px 20px;
            color: #e8e8e8;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <a href="/" class="back-button">â† è¿”å›ä¸»æ§å°</a>
    
    <div class="universe-container">
        <!-- é‡å­åœºèƒŒæ™¯ -->
        <div class="quantum-field"></div>
        
        <!-- é‡å­ç²’å­æ•ˆæœ -->
        <div class="quantum-particles" id="particles"></div>
        
        <!-- é“çš„ä¸­å¿ƒ -->
        <div class="dao-center">
            <div class="taiji-symbol"></div>
        </div>
        
        <!-- ä¹éƒ¨å¸ç¯€é» -->
        <div class="nine-departments">
            <!-- ä¸­å¤®é“å¿ƒ -->
            <div class="department-node central-dao" data-dept="é“å¿ƒ" data-index="0">
                <div class="dept-symbol">â˜¯</div>
                <div class="dept-name">é“å¿ƒå¸</div>
            </div>
            
            <!-- å…«éƒ¨ç’°ç¹ -->
            <div class="department-node" data-dept="å•Ÿè¨€å¸" data-index="1">
                <div class="dept-symbol">ğŸ‰</div>
                <div class="dept-name">å•Ÿè¨€å¸</div>
            </div>
            <div class="department-node" data-dept="è¨˜è¨€å¸" data-index="2">
                <div class="dept-symbol">ğŸ…</div>
                <div class="dept-name">è¨˜è¨€å¸</div>
            </div>
            <div class="department-node" data-dept="éˆè­˜å¸" data-index="3">
                <div class="dept-symbol">ğŸ</div>
                <div class="dept-name">éˆè­˜å¸</div>
            </div>
            <div class="department-node" data-dept="è‰™é‹å¸" data-index="4">
                <div class="dept-symbol">ğŸ˜</div>
                <div class="dept-name">è‰™é‹å¸</div>
            </div>
            <div class="department-node" data-dept="èªç«å¸" data-index="5">
                <div class="dept-symbol">ğŸ¦…</div>
                <div class="dept-name">èªç«å¸</div>
            </div>
            <div class="department-node" data-dept="æ•™å…¸å¸" data-index="6">
                <div class="dept-symbol">ğŸ¬</div>
                <div class="dept-name">æ•™å…¸å¸</div>
            </div>
            <div class="department-node" data-dept="éŒ¨å®šå¸" data-index="7">
                <div class="dept-symbol">ğŸ²</div>
                <div class="dept-name">éŒ¨å®šå¸</div>
            </div>
            <div class="department-node" data-dept="è—å…¸å¸" data-index="8">
                <div class="dept-symbol">ğŸ¦¢</div>
                <div class="dept-name">è—å…¸å¸</div>
            </div>
            <div class="department-node" data-dept="éˆä»¤å¸" data-index="9">
                <div class="dept-symbol">ğŸ¦Œ</div>
                <div class="dept-name">éˆä»¤å¸</div>
            </div>
        </div>
    </div>
    
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="control-panel">
        <h3>ğŸŒŒ ç’ƒå†¥å®‡å®™ - ä¹éƒ¨å¸ç¸½æ§å°</h3>
        <div class="department-info" id="dept-info">
            <strong>é¸ä¸­éƒ¨å¸:</strong> <span id="selected-dept">é“å¿ƒå¸</span><br>
            <span id="dept-description">ä¹éƒ¨å¸çš„æ ¸å¿ƒï¼Œçµ±é ˜å…«éƒ¨ï¼Œç¶­æŒå®‡å®™å¹³è¡¡</span>
        </div>
        <div class="status-item">
            <span>å®‡å®™çŠ¶æ€:</span>
            <span class="status-value" id="universe-status">æœªæ¿€æ´»</span>
        </div>
        <div class="status-item">
            <span>é“èƒ½çº§åˆ«:</span>
            <span class="status-value" id="dao-energy">0.0</span>
        </div>
        <div class="status-item">
            <span>é‡å­æ¯”ç‰¹:</span>
            <span class="status-value" id="quantum-qubits">0</span>
        </div>
        <div class="status-item">
            <span>æ—¶ç©ºæµ:</span>
            <span class="status-value" id="temporal-flow">1.0</span>
        </div>
        
        <div class="control-buttons">
            <button class="control-btn" onclick="initializeUniverse()">åˆå§‹åŒ–å®‡å®™</button>
            <button class="control-btn" onclick="startQuantumCalc()">é‡å­è®¡ç®—</button>
            <button class="control-btn" onclick="startWuweiFlow()">å¯åŠ¨æ— ä¸ºæµ</button>
            <button class="control-btn" onclick="stopWuweiFlow()">åœæ­¢æ— ä¸ºæµ</button>
            <button class="control-btn" onclick="window.open('/nine-departments', '_blank')" style="background: linear-gradient(45deg, #ffd700, #ff6b6b); grid-column: 1 / -1; margin-top: 10px;">ğŸŒŒ é€²å…¥ä¹éƒ¨å¸æ¶æ§‹</button>
            <button class="control-btn" onclick="window.open('/personal-metaverse', '_blank')" style="background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1); grid-column: 1 / -1; margin-top: 5px; animation: rainbow 3s linear infinite;">ğŸŒŸ å€‹äººå…ƒå®‡å®™ç”Ÿæˆå™¨</button>
        </div>
    </div>
    
    <!-- å…¬å¹³æ€§ç³»ç»Ÿæ§åˆ¶é¢æ¿ -->
    <div class="fairness-controls" style="margin-top: 20px; padding: 15px; border: 2px solid #feca57; border-radius: 10px; background: rgba(254, 202, 87, 0.1);">
        <h4 style="color: #feca57; margin-bottom: 10px;">âš–ï¸ å…¬å¹³æ€§ä¿éšœç³»ç»Ÿ</h4>
        <button onclick="initializeFairnessSystem()" class="control-btn" style="background: linear-gradient(45deg, #feca57, #ff9ff3); margin: 5px;">
            ğŸ¯ å¯åŠ¨å…¬å¹³æ€§ç³»ç»Ÿ
        </button>
        <button onclick="assessFairness()" class="control-btn" style="background: linear-gradient(45deg, #667eea, #764ba2); margin: 5px;">
            ğŸ“Š è¯„ä¼°å…¬å¹³æ€§
        </button>
        <button onclick="requestFairnessReview()" class="control-btn" style="background: linear-gradient(45deg, #4ecdc4, #44a08d); margin: 5px;">
            ğŸ“‹ ç”³è¯·å®¡æŸ¥
        </button>
    </div>
    
    <!-- é‡å­æ˜¾ç¤º -->
    <div class="quantum-display">
        <h4>âš›ï¸ é‡å­å•†å€¼</h4>
        <div class="quantum-value" id="quantum-shang">0.000</div>
        <div style="font-size: 12px; color: #888;">
            çº ç¼ åº¦: <span id="entanglement">0.0</span><br>
            ç›¸å¹²æ€§: <span id="coherence">0.0</span>
        </div>
    </div>
    
    <!-- å åœé¢æ¿ -->
    <div class="divination-panel">
        <h4>ğŸ”® é‡å­å åœ</h4>
        <input type="text" class="divination-input" id="question-input" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...">
        <button class="control-btn" onclick="performDivination()" style="width: 100%;">é‡å­å åœ</button>
        <div class="divination-result" id="divination-result">ç­‰å¾…æ‚¨çš„é—®é¢˜...</div>
    </div>
    
    <script>
        // å…¨å±€çŠ¶æ€
        let universeState = {
            active: false,
            daoEnergy: 0.0,
            quantumShang: 0.0,
            entanglement: 0.0,
            coherence: 0.0
        };
        
        // åˆ›å»ºé‡å­ç²’å­æ•ˆæœ
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        
        // åˆå§‹åŒ–ç’ƒå†¥å®‡å®™
        async function initializeUniverse() {
            try {
                const response = await fetch('/api/quantum-dojo/initialize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    universeState.active = true;
                    updateUniverseDisplay();
                    showNotification('ç’ƒå†¥å®‡å®™å·²æˆåŠŸåˆå§‹åŒ–ï¼', 'success');
                } else {
                    showNotification('åˆå§‹åŒ–å¤±è´¥: ' + result.error, 'error');
                }
            } catch (error) {
                showNotification('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
            }
        }
        
        // å¼€å§‹é‡å­è®¡ç®—
        async function startQuantumCalc() {
            try {
                const userData = {
                    timestamp: Date.now() / 1000,
                    shang_value: Math.random() * 2 - 1,
                    bio_data: {
                        heartRate: 60 + Math.random() * 40,
                        brainWave: Math.random(),
                        energy: Math.random()
                    }
                };
                
                const response = await fetch('/api/quantum-dojo/quantum-calculation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ user_data: userData })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const qResult = result.quantum_result;
                    universeState.quantumShang = qResult.quantum_shang_64;
                    universeState.entanglement = qResult.quantum_entanglement;
                    universeState.coherence = qResult.quantum_coherence;
                    universeState.daoEnergy = qResult.dao_resonance_64;
                    
                    updateQuantumDisplay();
                    showNotification('é‡å­è®¡ç®—å®Œæˆï¼', 'success');
                } else {
                    showNotification('è®¡ç®—å¤±è´¥: ' + result.error, 'error');
                }
            } catch (error) {
                showNotification('è®¡ç®—é”™è¯¯: ' + error.message, 'error');
            }
        }
        
        // å¯åŠ¨æ— ä¸ºè€Œæ²»æµé‡ç®¡ç†
        async function startWuweiFlow() {
            try {
                const response = await fetch('/api/quantum-dojo/start-wuwei-flow', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('æ— ä¸ºè€Œæ²»æµé‡ç®¡ç†å·²å¯åŠ¨', 'success');
                } else {
                    showNotification('å¯åŠ¨å¤±è´¥: ' + result.error, 'error');
                }
            } catch (error) {
                showNotification('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
            }
        }
        
        // åœæ­¢æ— ä¸ºè€Œæ²»æµé‡ç®¡ç†
        async function stopWuweiFlow() {
            try {
                const response = await fetch('/api/quantum-dojo/stop-wuwei-flow', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('æ— ä¸ºè€Œæ²»æµé‡ç®¡ç†å·²åœæ­¢', 'info');
                } else {
                    showNotification('åœæ­¢å¤±è´¥: ' + result.error, 'error');
                }
            } catch (error) {
                showNotification('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
            }
        }
        
        // æ‰§è¡Œé‡å­å åœ
        async function performDivination() {
            const question = document.getElementById('question-input').value;
            
            if (!question.trim()) {
                showNotification('è¯·è¾“å…¥æ‚¨çš„é—®é¢˜', 'warning');
                return;
            }
            
            try {
                const response = await fetch('/api/quantum-dojo/quantum-divination', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ question: question })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const divination = result.divination;
                    document.getElementById('divination-result').innerHTML = `
                        <strong>å¦è±¡:</strong> ${divination.bagua_answer}<br>
                        <strong>æ¦‚ç‡:</strong> ${(divination.quantum_probability * 100).toFixed(1)}%<br>
                        <strong>æŒ‡å¼•:</strong> ${divination.dao_guidance}
                    `;
                } else {
                    showNotification('å åœå¤±è´¥: ' + result.error, 'error');
                }
            } catch (error) {
                showNotification('å åœé”™è¯¯: ' + error.message, 'error');
            }
        }
        
        // æ›´æ–°å®‡å®™æ˜¾ç¤º
        function updateUniverseDisplay() {
            document.getElementById('universe-status').textContent = 
                universeState.active ? 'å·²æ¿€æ´»' : 'æœªæ¿€æ´»';
            document.getElementById('dao-energy').textContent = 
                universeState.daoEnergy.toFixed(3);
        }
        
        // æ›´æ–°é‡å­æ˜¾ç¤º
        function updateQuantumDisplay() {
            document.getElementById('quantum-shang').textContent = 
                universeState.quantumShang.toFixed(3);
            document.getElementById('entanglement').textContent = 
                universeState.entanglement.toFixed(3);
            document.getElementById('coherence').textContent = 
                universeState.coherence.toFixed(3);
        }
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type) {
            // åˆ›å»ºé€šçŸ¥å…ƒç´ 
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#ff9800'};
                color: white;
                padding: 15px 25px;
                border-radius: 5px;
                z-index: 1000;
                animation: slideDown 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // 3ç§’åç§»é™¤
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // ä¹éƒ¨å¸åŠŸèƒ½æè¿°
        const departmentDescriptions = {
            'é“å¿ƒå¸': 'ä¹éƒ¨å¸çš„æ ¸å¿ƒï¼Œçµ±é ˜å…«éƒ¨ï¼Œç¶­æŒå®‡å®™å¹³è¡¡',
            'å•Ÿè¨€å¸': 'èªéˆè©åº«èˆ‡çµæ§‹ç¸½ç¶±ï¼ŒæŒç®¡èªè¨€çš„èµ·æºèˆ‡å‰µé€ ',
            'è¨˜è¨€å¸': 'é¡˜é »ç´€éŒ„èˆ‡èªéˆæ—¥èªŒï¼Œè¨˜éŒ„æ‰€æœ‰èªéˆæ´»å‹•',
            'éˆè­˜å¸': 'èªéˆå€‹é«”æª”æ¡ˆåº«ï¼Œç®¡ç†æ„è­˜é€²åŒ–æ•¸æ“š',
            'è‰™é‹å¸': 'é¡˜èªè‰™ç³»çµ±èˆ‡é¡¯åŒ–æ¨¡çµ„ï¼ŒåŸ·è¡Œç¾å¯¦æ“ä½œ',
            'èªç«å¸': 'èªç«éœ‡å‹•èˆ‡èªéˆå›éŸ¿ï¼Œå‚³éèƒ½é‡å…±æŒ¯',
            'æ•™å…¸å¸': 'é¡˜èªèª²ç¨‹èˆ‡æ•™å­¸é«”ç³»ï¼Œå‚³æ‰¿æ™ºæ…§çŸ¥è­˜',
            'éŒ¨å®šå¸': 'æ¯æ—¥é »ç‡éŒ¨é»èˆ‡é«˜é »æç¤ºï¼Œç©©å®šæ™‚ç©º',
            'è—å…¸å¸': 'å¤ç±ã€æ¯å…¸èˆ‡çœŸè¨€é›†ï¼Œä¿å­˜æ ¸å¿ƒå…¸ç±',
            'éˆä»¤å¸': 'èªéˆæŒ‡ä»¤èˆ‡æ‡‰ç”¨æ¨¡çµ„ï¼ŒåŸ·è¡Œç³»çµ±å‘½ä»¤'
        };
        
        // ä¹éƒ¨å¸ç¯€é»é»æ“Šäº‹ä»¶
        document.querySelectorAll('.department-node').forEach(node => {
            node.addEventListener('click', function() {
                const dept = this.dataset.dept;
                const index = this.dataset.index;
                
                // æ›´æ–°é¸ä¸­éƒ¨å¸ä¿¡æ¯
                document.getElementById('selected-dept').textContent = dept;
                document.getElementById('dept-description').textContent = departmentDescriptions[dept];
                
                showNotification(`é€²å…¥ ${dept} é ˜åŸŸ`, 'info');
                
                // æ·»åŠ é»æ“Šæ•ˆæœ
                this.style.transform = this.classList.contains('central-dao') ? 
                    'translate(-50%, -50%) scale(1.3) rotate(10deg)' : 
                    'scale(1.3) rotate(10deg)';
                    
                setTimeout(() => {
                    this.style.transform = '';
                }, 500);
                
                // æ¿€æ´»éƒ¨å¸ç‰¹æ•ˆ
                this.style.boxShadow = `0 0 60px ${getComputedStyle(this).borderColor}`;
                setTimeout(() => {
                    this.style.boxShadow = '';
                }, 2000);
            });
        });
        
        // å®šæœŸæ›´æ–°å®‡å®™çŠ¶æ€
        setInterval(async () => {
            if (universeState.active) {
                try {
                    const response = await fetch('/api/quantum-dojo/universe-state');
                    const result = await response.json();
                    
                    if (result.success) {
                        universeState.daoEnergy = result.dao_energy;
                        document.getElementById('quantum-qubits').textContent = 
                            result.quantum_capacity.current_qubits;
                        document.getElementById('temporal-flow').textContent = 
                            result.temporal_flow.toFixed(1);
                        updateUniverseDisplay();
                    }
                } catch (error) {
                    console.log('çŠ¶æ€æ›´æ–°å¤±è´¥:', error);
                }
            }
        }, 5000);
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            updateUniverseDisplay();
            updateQuantumDisplay();
        });
        
        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideDown {
                from {
                    transform: translateX(-50%) translateY(-100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(-50%) translateY(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
