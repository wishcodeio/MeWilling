{% extends "base.html" %}

{% block title %}量子象棋 | 商增靈性系統{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-blue-900 text-white">
    <!-- 页面标题 -->
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
                ♛ 量子象棋 ♛
            </h1>
            <p class="text-xl text-gray-300 mb-6">在量子叠加态中体验传统象棋的无限可能</p>
            
            <!-- 初学者说明 -->
            <div class="bg-gradient-to-r from-purple-800/30 to-blue-800/30 rounded-lg p-6 mb-8 border border-purple-500/30">
                <h2 class="text-2xl font-semibold mb-4 text-yellow-300">🌟 初学者指南</h2>
                <div class="grid md:grid-cols-2 gap-6 text-left">
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-blue-300">📚 量子象棋基础</h3>
                        <ul class="space-y-2 text-gray-300">
                            <li>• <strong>叠加态：</strong>棋子可以同时存在于多个位置</li>
                            <li>• <strong>量子分裂：</strong>一步棋可以创造多种可能性</li>
                            <li>• <strong>测量塌缩：</strong>观察时棋子确定位置</li>
                            <li>• <strong>量子纠缠：</strong>棋子间存在神秘关联</li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-green-300">🎯 游戏目标</h3>
                        <ul class="space-y-2 text-gray-300">
                            <li>• 将死对方的将/帅</li>
                            <li>• 利用量子特性创造优势</li>
                            <li>• 在不确定性中寻找确定性</li>
                            <li>• 体验量子思维的奥妙</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 象棋口诀 -->
            <div class="bg-gradient-to-r from-yellow-800/30 to-orange-800/30 rounded-lg p-6 mb-8 border border-yellow-500/30">
                <h2 class="text-2xl font-semibold mb-4 text-yellow-300">📜 量子象棋口诀</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="bg-black/20 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-purple-300 mb-2">🌀 分裂心诀</h4>
                            <p class="text-gray-300 italic">"一心二用，虚实并存，<br>未测之前，皆为可能"</p>
                        </div>
                        <div class="bg-black/20 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-blue-300 mb-2">🔄 合并心诀</h4>
                            <p class="text-gray-300 italic">"万法归一，测量定真，<br>选择当下，塌缩成形"</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-black/20 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-green-300 mb-2">🌐 纠缠心诀</h4>
                            <p class="text-gray-300 italic">"彼此相依，命运共振，<br>一动全动，因果相连"</p>
                        </div>
                        <div class="bg-black/20 rounded-lg p-4">
                            <h4 class="text-lg font-semibold text-red-300 mb-2">⚡ 观测心诀</h4>
                            <p class="text-gray-300 italic">"观者改变，测者定形，<br>意识之力，塑造现实"</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 传统象棋口诀 -->
            <div class="bg-gradient-to-r from-red-800/30 to-pink-800/30 rounded-lg p-6 mb-8 border border-red-500/30">
                <h2 class="text-2xl font-semibold mb-4 text-red-300">🏮 传统象棋口诀</h2>
                <div class="grid md:grid-cols-3 gap-4 text-sm">
                    <div class="bg-black/20 rounded-lg p-3">
                        <h5 class="font-semibold text-yellow-300 mb-2">开局要诀</h5>
                        <p class="text-gray-300">"马走日，象走田，<br>炮打隔山，车走直线"</p>
                    </div>
                    <div class="bg-black/20 rounded-lg p-3">
                        <h5 class="font-semibold text-blue-300 mb-2">中局要诀</h5>
                        <p class="text-gray-300">"兵贵神速，马有八面威风，<br>炮镇中宫，车控要道"</p>
                    </div>
                    <div class="bg-black/20 rounded-lg p-3">
                        <h5 class="font-semibold text-green-300 mb-2">残局要诀</h5>
                        <p class="text-gray-300">"卒子过河，胜过九车，<br>马踏四方，将帅难逃"</p>
                    </div>
                    <div class="bg-black/20 rounded-lg p-3">
                        <h5 class="font-semibold text-purple-300 mb-2">战术要诀</h5>
                        <p class="text-gray-300">"弃子争先，舍车保帅，<br>声东击西，暗度陈仓"</p>
                    </div>
                    <div class="bg-black/20 rounded-lg p-3">
                        <h5 class="font-semibold text-orange-300 mb-2">心法要诀</h5>
                        <p class="text-gray-300">"静如处子，动如脱兔，<br>胸有成竹，心无旁骛"</p>
                    </div>
                    <div class="bg-black/20 rounded-lg p-3">
                        <h5 class="font-semibold text-cyan-300 mb-2">制胜要诀</h5>
                        <p class="text-gray-300">"攻其不备，出其不意，<br>知己知彼，百战不殆"</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 游戏控制面板 -->
        <div class="max-w-6xl mx-auto">
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- 游戏设置 -->
                <div class="lg:col-span-1">
                    <div class="bg-black/30 rounded-lg p-6 border border-purple-500/30">
                        <h3 class="text-xl font-semibold mb-4 text-purple-300">🎮 游戏设置</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">游戏模式</label>
                                <select id="gameMode" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white">
                                    <option value="self">自我对弈</option>
                                    <option value="ai-easy">AI对战(简单)</option>
                                    <option value="ai-medium">AI对战(中等)</option>
                                    <option value="ai-hard">AI对战(困难)</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">量子模式</label>
                                <div class="flex items-center space-x-2">
                                    <input type="checkbox" id="quantumMode" checked class="rounded">
                                    <span>启用量子特性</span>
                                </div>
                            </div>
                            
                            <div class="space-y-2">
                                <button id="startGame" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                    🚀 开始游戏
                                </button>
                                <button id="resetGame" class="w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                    🔄 重置游戏
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 量子控制 -->
                    <div class="bg-black/30 rounded-lg p-6 border border-blue-500/30 mt-6">
                        <h3 class="text-xl font-semibold mb-4 text-blue-300">⚛️ 量子控制</h3>
                        
                        <div class="space-y-2">
                            <button id="quantumSplit" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                🌀 量子分裂
                            </button>
                            <button id="quantumMerge" class="w-full bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                🔄 量子合并
                            </button>
                            <button id="measurePiece" class="w-full bg-gradient-to-r from-green-600 to-teal-600 hover:from-green-700 hover:to-teal-700 px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                📏 量子测量
                            </button>
                            <button id="createEntanglement" class="w-full bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                🌐 创建纠缠
                            </button>
                        </div>
                    </div>

                    <!-- 游戏状态 -->
                    <div class="bg-black/30 rounded-lg p-6 border border-green-500/30 mt-6">
                        <h3 class="text-xl font-semibold mb-4 text-green-300">📊 游戏状态</h3>
                        
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between">
                                <span>当前回合:</span>
                                <span id="currentPlayer" class="font-semibold text-red-400">红方</span>
                            </div>
                            <div class="flex justify-between">
                                <span>移动次数:</span>
                                <span id="moveCount" class="font-semibold">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>量子态数:</span>
                                <span id="quantumStates" class="font-semibold text-purple-400">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span>纠缠对数:</span>
                                <span id="entanglementPairs" class="font-semibold text-blue-400">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 棋盘区域 -->
                <div class="lg:col-span-2">
                    <div class="bg-black/30 rounded-lg p-6 border border-yellow-500/30">
                        <h3 class="text-xl font-semibold mb-4 text-yellow-300 text-center">🏁 量子象棋棋盘</h3>
                        
                        <!-- 玩家信息 -->
                        <div class="flex justify-between mb-6">
                            <div class="bg-red-900/30 rounded-lg p-4 border border-red-500/50">
                                <div class="text-center">
                                    <div class="text-lg font-semibold text-red-300">红方 (下)</div>
                                    <div id="redPlayerStatus" class="text-sm text-gray-300">等待开始</div>
                                </div>
                            </div>
                            <div class="bg-gray-900/30 rounded-lg p-4 border border-gray-500/50">
                                <div class="text-center">
                                    <div class="text-lg font-semibold text-gray-300">黑方 (上)</div>
                                    <div id="blackPlayerStatus" class="text-sm text-gray-300">等待开始</div>
                                </div>
                            </div>
                        </div>

                        <!-- 象棋棋盘 -->
                        <div class="chess-board-container">
                            <div id="chessBoard" class="chess-board mx-auto">
                                <!-- 棋盘将通过JavaScript动态生成 -->
                            </div>
                        </div>

                        <!-- 游戏控制按钮 -->
                        <div class="flex justify-center space-x-4 mt-6">
                            <button id="undoMove" class="bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                ↶ 悔棋
                            </button>
                            <button id="hintMove" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                💡 提示
                            </button>
                            <button id="pauseGame" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg font-semibold transition-all duration-300">
                                ⏸️ 暂停
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 游戏日志和反思 -->
            <div class="grid md:grid-cols-2 gap-8 mt-8">
                <!-- 游戏日志 -->
                <div class="bg-black/30 rounded-lg p-6 border border-cyan-500/30">
                    <h3 class="text-xl font-semibold mb-4 text-cyan-300">📝 游戏日志</h3>
                    <div id="gameLog" class="h-64 overflow-y-auto bg-gray-900/50 rounded-lg p-4 text-sm space-y-2">
                        <div class="text-gray-400">游戏日志将在这里显示...</div>
                    </div>
                </div>

                <!-- 量子反思 -->
                <div class="bg-black/30 rounded-lg p-6 border border-purple-500/30">
                    <h3 class="text-xl font-semibold mb-4 text-purple-300">🧘 量子反思</h3>
                    <div id="quantumReflection" class="h-64 overflow-y-auto bg-gray-900/50 rounded-lg p-4 text-sm">
                        <div class="space-y-3">
                            <p class="text-gray-300">在量子象棋中观察你的思维模式：</p>
                            <ul class="space-y-2 text-gray-400">
                                <li>• 你如何处理不确定性和叠加态？</li>
                                <li>• 面对量子纠缠时的策略选择？</li>
                                <li>• 分裂移动反映了什么心理状态？</li>
                                <li>• 测量时机的把握体现了什么智慧？</li>
                                <li>• 在多重可能性中如何做出决策？</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* 象棋棋盘样式 */
.chess-board {
    width: 100%;
    max-width: 500px;
    aspect-ratio: 9/10;
    background: linear-gradient(45deg, #8B4513, #D2691E);
    border: 3px solid #654321;
    border-radius: 10px;
    display: grid;
    grid-template-columns: repeat(9, 1fr);
    grid-template-rows: repeat(10, 1fr);
    gap: 1px;
    padding: 10px;
    position: relative;
}

.chess-square {
    background: #FAEBD7;
    border: 1px solid #D2691E;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
}

.chess-square:hover {
    background: rgba(255, 215, 0, 0.3);
    transform: scale(1.05);
}

.chess-square.selected {
    background: rgba(0, 255, 0, 0.4) !important;
    box-shadow: 0 0 15px rgba(0, 255, 0, 0.6);
    border: 2px solid #00ff00;
}

.chess-square.possible-move {
    background: rgba(255, 255, 0, 0.4) !important;
    border: 2px dashed #ffff00;
}

.chess-square.superposition {
    background: linear-gradient(45deg, rgba(0, 255, 0, 0.3), rgba(0, 255, 255, 0.3)) !important;
    animation: quantumPulse 2s infinite;
}

.chess-square.entangled {
    background: linear-gradient(45deg, rgba(255, 0, 255, 0.3), rgba(255, 100, 255, 0.3)) !important;
    animation: entanglementGlow 1.5s infinite alternate;
}

.chess-piece {
    font-size: 1.5rem;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    transition: all 0.3s ease;
    z-index: 10;
}

.red-piece {
    color: #DC143C;
}

.black-piece {
    color: #2F4F4F;
}

.quantum-piece {
    position: relative;
    animation: quantumFlicker 3s infinite;
}

.quantum-piece::after {
    content: '⚛️';
    position: absolute;
    top: -8px;
    right: -8px;
    font-size: 0.6em;
    opacity: 0.8;
    animation: spin 2s linear infinite;
}

/* 动画效果 */
@keyframes quantumPulse {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
}

@keyframes entanglementGlow {
    0% { box-shadow: 0 0 10px rgba(255, 0, 255, 0.5); }
    100% { box-shadow: 0 0 20px rgba(255, 0, 255, 0.8); }
}

@keyframes quantumFlicker {
    0%, 100% { opacity: 1; }
    25% { opacity: 0.7; }
    50% { opacity: 0.9; }
    75% { opacity: 0.8; }
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* 楚河汉界 */
.chess-board::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 10px;
    right: 10px;
    height: 2px;
    background: linear-gradient(90deg, transparent, #654321, transparent);
    transform: translateY(-50%);
    z-index: 5;
}

/* 响应式设计 */
@media (max-width: 768px) {
    .chess-board {
        max-width: 350px;
    }
    
    .chess-piece {
        font-size: 1.2rem;
    }
}
</style>

<script>
// 量子象棋游戏逻辑
class QuantumChess {
    constructor() {
        this.board = null;
        this.selectedSquare = null;
        this.currentPlayer = 'red';
        this.gameMode = 'self';
        this.quantumMode = true;
        this.gameStarted = false;
        this.moveHistory = [];
        this.superpositionPieces = new Map();
        this.entangledPairs = new Map();
        this.nextPieceId = 1;
        
        this.initializeGame();
        this.bindEvents();
    }
    
    initializeGame() {
        this.createBoard();
        this.setupInitialPosition();
        this.updateGameStatus();
    }
    
    createBoard() {
        const board = document.getElementById('chessBoard');
        board.innerHTML = '';
        
        for (let row = 0; row < 10; row++) {
            for (let col = 0; col < 9; col++) {
                const square = document.createElement('div');
                square.className = 'chess-square';
                square.dataset.row = row;
                square.dataset.col = col;
                square.addEventListener('click', (e) => this.handleSquareClick(e));
                board.appendChild(square);
            }
        }
    }
    
    setupInitialPosition() {
        const initialBoard = [
            ['車','馬','象','士','將','士','象','馬','車'],
            ['','','','','','','','',''],
            ['','砲','','','','','','砲',''],
            ['卒','','卒','','卒','','卒','','卒'],
            ['','','','','','','','',''],
            ['','','','','','','','',''],
            ['兵','','兵','','兵','','兵','','兵'],
            ['','炮','','','','','','炮',''],
            ['','','','','','','','',''],
            ['俥','傌','相','仕','帥','仕','相','傌','俥']
        ];
        
        this.board = initialBoard;
        
        for (let row = 0; row < 10; row++) {
            for (let col = 0; col < 9; col++) {
                const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                const piece = initialBoard[row][col];
                if (piece) {
                    const pieceElement = document.createElement('span');
                    pieceElement.className = 'chess-piece';
                    pieceElement.textContent = piece;
                    
                    if (row <= 4) {
                        pieceElement.classList.add('black-piece');
                        pieceElement.dataset.color = 'black';
                    } else {
                        pieceElement.classList.add('red-piece');
                        pieceElement.dataset.color = 'red';
                    }
                    
                    square.appendChild(pieceElement);
                }
            }
        }
    }
    
    bindEvents() {
        document.getElementById('startGame').addEventListener('click', () => this.startGame());
        document.getElementById('resetGame').addEventListener('click', () => this.resetGame());
        document.getElementById('quantumSplit').addEventListener('click', () => this.enableQuantumSplit());
        document.getElementById('quantumMerge').addEventListener('click', () => this.enableQuantumMerge());
        document.getElementById('measurePiece').addEventListener('click', () => this.enableMeasurement());
        document.getElementById('createEntanglement').addEventListener('click', () => this.enableEntanglement());
        document.getElementById('undoMove').addEventListener('click', () => this.undoMove());
        document.getElementById('hintMove').addEventListener('click', () => this.showHint());
        document.getElementById('pauseGame').addEventListener('click', () => this.pauseGame());
    }
    
    handleSquareClick(event) {
        const square = event.currentTarget;
        const piece = square.querySelector('.chess-piece');
        
        if (!this.gameStarted) {
            this.addLog('请先开始游戏');
            return;
        }
        
        // 清除之前的选择
        document.querySelectorAll('.chess-square.selected').forEach(sq => {
            sq.classList.remove('selected');
        });
        document.querySelectorAll('.chess-square.possible-move').forEach(sq => {
            sq.classList.remove('possible-move');
        });
        
        if (this.selectedSquare) {
            if (this.selectedSquare === square) {
                this.selectedSquare = null;
                return;
            }
            
            if (this.isValidMove(this.selectedSquare, square)) {
                this.movePiece(this.selectedSquare, square);
                this.selectedSquare = null;
                this.switchPlayer();
            } else {
                this.selectedSquare = null;
            }
        } else if (piece && piece.dataset.color === this.currentPlayer) {
            this.selectedSquare = square;
            square.classList.add('selected');
            this.showPossibleMoves(square);
        }
    }
    
    isValidMove(fromSquare, toSquare) {
        const fromRow = parseInt(fromSquare.dataset.row);
        const fromCol = parseInt(fromSquare.dataset.col);
        const toRow = parseInt(toSquare.dataset.row);
        const toCol = parseInt(toSquare.dataset.col);
        
        if (fromRow === toRow && fromCol === toCol) return false;
        
        const targetPiece = toSquare.querySelector('.chess-piece');
        const movingPiece = fromSquare.querySelector('.chess-piece');
        if (targetPiece && targetPiece.dataset.color === movingPiece.dataset.color) {
            return false;
        }
        
        if (toRow < 0 || toRow >= 10 || toCol < 0 || toCol >= 9) return false;
        
        return true;
    }
    
    showPossibleMoves(square) {
        const row = parseInt(square.dataset.row);
        const col = parseInt(square.dataset.col);
        
        const directions = [
            [-1, 0], [1, 0], [0, -1], [0, 1],
            [-1, -1], [-1, 1], [1, -1], [1, 1]
        ];
        
        directions.forEach(([dr, dc]) => {
            const newRow = row + dr;
            const newCol = col + dc;
            if (newRow >= 0 && newRow < 10 && newCol >= 0 && newCol < 9) {
                const targetSquare = document.querySelector(`[data-row="${newRow}"][data-col="${newCol}"]`);
                if (targetSquare && this.isValidMove(square, targetSquare)) {
                    targetSquare.classList.add('possible-move');
                }
            }
        });
    }
    
    movePiece(fromSquare, toSquare) {
        const piece = fromSquare.querySelector('.chess-piece');
        if (piece) {
            const move = {
                from: { row: fromSquare.dataset.row, col: fromSquare.dataset.col },
                to: { row: toSquare.dataset.row, col: toSquare.dataset.col },
                piece: piece.textContent,
                captured: null
            };
            
            const targetPiece = toSquare.querySelector('.chess-piece');
            if (targetPiece) {
                move.captured = targetPiece.textContent;
                targetPiece.remove();
            }
            
            toSquare.appendChild(piece);
            this.moveHistory.push(move);
            
            this.addLog(`${move.piece} 从 (${move.from.row}, ${move.from.col}) 移动到 (${move.to.row}, ${move.to.col})`);
            this.addReflection(`移动 ${move.piece}：观察你的决策过程和直觉`);
            
            this.updateMoveCount();
        }
    }
    
    switchPlayer() {
        this.currentPlayer = this.currentPlayer === 'red' ? 'black' : 'red';
        this.updateGameStatus();
    }
    
    startGame() {
        this.gameStarted = true;
        this.gameMode = document.getElementById('gameMode').value;
        this.quantumMode = document.getElementById('quantumMode').checked;
        
        document.getElementById('redPlayerStatus').textContent = '思考中...';
        document.getElementById('blackPlayerStatus').textContent = '等待中';
        
        this.addLog('游戏开始！');
        this.addReflection('游戏开始：观察你的开局思路和心理状态');
    }
    
    resetGame() {
        this.gameStarted = false;
        this.currentPlayer = 'red';
        this.moveHistory = [];
        this.superpositionPieces.clear();
        this.entangledPairs.clear();
        this.selectedSquare = null;
        
        document.getElementById('gameLog').innerHTML = '<div class="text-gray-400">游戏日志将在这里显示...</div>';
        document.getElementById('quantumReflection').innerHTML = `
            <div class="space-y-3">
                <p class="text-gray-300">在量子象棋中观察你的思维模式：</p>
                <ul class="space-y-2 text-gray-400">
                    <li>• 你如何处理不确定性和叠加态？</li>
                    <li>• 面对量子纠缠时的策略选择？</li>
                    <li>• 分裂移动反映了什么心理状态？</li>
                    <li>• 测量时机的把握体现了什么智慧？</li>
                    <li>• 在多重可能性中如何做出决策？</li>
                </ul>
            </div>
        `;
        
        this.setupInitialPosition();
        this.updateGameStatus();
        this.updateMoveCount();
        this.updateQuantumStats();
        
        document.getElementById('redPlayerStatus').textContent = '等待开始';
        document.getElementById('blackPlayerStatus').textContent = '等待开始';
    }
    
    enableQuantumSplit() {
        if (!this.gameStarted || !this.quantumMode) {
            this.addLog('请先开始量子模式游戏');
            return;
        }
        this.addLog('量子分裂模式已启用 - 选择棋子进行分裂');
        this.addReflection('启用量子分裂：体验一心多用的量子思维');
    }
    
    enableQuantumMerge() {
        if (!this.gameStarted || !this.quantumMode) {
            this.addLog('请先开始量子模式游戏');
            return;
        }
        this.addLog('量子合并模式已启用 - 选择叠加态棋子进行合并');
        this.addReflection('启用量子合并：观察选择如何塌缩可能性');
    }
    
    enableMeasurement() {
        if (!this.gameStarted || !this.quantumMode) {
            this.addLog('请先开始量子模式游戏');
            return;
        }
        this.addLog('量子测量模式已启用 - 观察即改变');
        this.addReflection('启用量子测量：意识的力量如何影响现实');
    }
    
    enableEntanglement() {
        if (!this.gameStarted || !this.quantumMode) {
            this.addLog('请先开始量子模式游戏');
            return;
        }
        this.addLog('量子纠缠模式已启用 - 创建棋子间的神秘关联');
        this.addReflection('启用量子纠缠：感受万物相连的宇宙法则');
    }
    
    undoMove() {
        if (this.moveHistory.length === 0) {
            this.addLog('没有可以撤销的移动');
            return;
        }
        
        const lastMove = this.moveHistory.pop();
        // 实现撤销逻辑
        this.addLog('已撤销上一步移动');
        this.addReflection('撤销移动：反思决策的可逆性与后悔心理');
    }
    
    showHint() {
        this.addLog('💡 提示：观察棋局的整体态势，寻找最佳移动');
        this.addReflection('寻求提示：依赖外部指导还是相信内在智慧？');
    }
    
    pauseGame() {
        this.addLog('游戏已暂停');
        this.addReflection('暂停游戏：在静止中观察内心的波动');
    }
    
    updateGameStatus() {
        document.getElementById('currentPlayer').textContent = this.currentPlayer === 'red' ? '红方' : '黑方';
        document.getElementById('currentPlayer').className = this.currentPlayer === 'red' ? 'font-semibold text-red-400' : 'font-semibold text-gray-400';
    }
    
    updateMoveCount() {
        document.getElementById('moveCount').textContent = this.moveHistory.length;
    }
    
    updateQuantumStats() {
        document.getElementById('quantumStates').textContent = this.superpositionPieces.size;
        document.getElementById('entanglementPairs').textContent = this.entangledPairs.size;
    }
    
    addLog(message) {
        const log = document.getElementById('gameLog');
        const entry = document.createElement('div');
        entry.className = 'text-cyan-300';
        entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
        log.appendChild(entry);
        log.scrollTop = log.scrollHeight;
    }
    
    addReflection(message) {
        const reflection = document.getElementById('quantumReflection');
        const entry = document.createElement('div');
        entry.className = 'text-purple-300 border-l-2 border-purple-500 pl-3 mb-2';
        entry.textContent = `🧘 ${message}`;
        reflection.appendChild(entry);
        reflection.scrollTop = reflection.scrollHeight;
    }
}

// 初始化游戏
document.addEventListener('DOMContentLoaded', () => {
    new QuantumChess();
});
</script>
{% endblock %}