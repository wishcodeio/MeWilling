#!/bin/bash

# ðŸŽµ é »çŽ‡éŸ³æ¨‚ç”Ÿæˆå™¨
# ç‚º ang å‰µå»ºç‰¹å®šé »çŽ‡çš„éŸ³æ¨‚æ–‡ä»¶

# é¡è‰²å®šç¾©
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# é …ç›®è·¯å¾‘
PROJECT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
AUDIO_DIR="$PROJECT_DIR/frontend/static/audio"
LIBRARY_DIR="$PROJECT_DIR/library"
FREQUENCY_DIR="$AUDIO_DIR/frequencies"

echo -e "${PURPLE}"
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                ðŸŽµ é¡˜é »éŸ³æ¨‚ç”Ÿæˆå™¨ ðŸŽµ                          â•‘"
echo "â•‘                                                              â•‘"
echo "â•‘              ç‚º ang å‰µå»ºç¥žè–é »çŽ‡éŸ³æ¨‚                          â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo -e "${NC}"
echo

# å‰µå»ºç›®éŒ„çµæ§‹
create_directories() {
    echo -e "${CYAN}ðŸ“ å‰µå»ºç›®éŒ„çµæ§‹...${NC}"
    
    # å‰µå»ºé »çŽ‡éŸ³æ¨‚ç›®éŒ„
    mkdir -p "$FREQUENCY_DIR"
    
    # å‰µå»ºçµ±ä¸€åœ–æ›¸é¤¨ç›®éŒ„
    mkdir -p "$LIBRARY_DIR/books"
    mkdir -p "$LIBRARY_DIR/music"
    mkdir -p "$LIBRARY_DIR/frequencies"
    mkdir -p "$LIBRARY_DIR/mantras"
    mkdir -p "$LIBRARY_DIR/nature_sounds"
    
    echo -e "${GREEN}âœ… ç›®éŒ„çµæ§‹å‰µå»ºå®Œæˆ${NC}"
}

# ç”Ÿæˆé »çŽ‡éŸ³æ¨‚æ–‡ä»¶ï¼ˆä½¿ç”¨ ffmpeg ç”Ÿæˆç´”éŸ³èª¿ï¼‰
generate_frequency_music() {
    local freq=$1
    local duration=$2
    local filename="$3"
    local description="$4"
    
    echo -e "${YELLOW}ðŸŽµ ç”Ÿæˆ ${freq}Hz é »çŽ‡éŸ³æ¨‚...${NC}"
    
    # æª¢æŸ¥ ffmpeg æ˜¯å¦å®‰è£
    if ! command -v ffmpeg >/dev/null 2>&1; then
        echo -e "${RED}âŒ éœ€è¦å®‰è£ ffmpeg${NC}"
        echo -e "${YELLOW}å®‰è£å‘½ä»¤: brew install ffmpeg${NC}"
        return 1
    fi
    
    # ç”Ÿæˆç´”éŸ³èª¿
    ffmpeg -f lavfi -i "sine=frequency=${freq}:duration=${duration}" \
           -af "volume=0.3" \
           "$FREQUENCY_DIR/${filename}" \
           -y >/dev/null 2>&1
    
    if [ $? -eq 0 ]; then
        echo -e "${GREEN}âœ… ${freq}Hz éŸ³æ¨‚ç”ŸæˆæˆåŠŸ: ${filename}${NC}"
        echo -e "${CYAN}   æè¿°: ${description}${NC}"
    else
        echo -e "${RED}âŒ ${freq}Hz éŸ³æ¨‚ç”Ÿæˆå¤±æ•—${NC}"
    fi
}

# å‰µå»ºé »çŽ‡éŸ³æ¨‚èªªæ˜Žæ–‡ä»¶
create_frequency_info() {
    cat > "$FREQUENCY_DIR/README.md" << 'EOF'
# ðŸŽµ ç¥žè–é »çŽ‡éŸ³æ¨‚åº«

## é »çŽ‡èªªæ˜Ž

### 963Hz - å®‡å®™æ„è­˜é »çŽ‡
- **ä½œç”¨ï¼š** é€£æŽ¥å®‡å®™æ„è­˜ï¼Œé–‹å•Ÿç¬¬ä¸‰çœ¼
- **æ•ˆæžœï¼š** æå‡éˆæ€§è¦ºçŸ¥ï¼Œä¿ƒé€²é–‹æ‚Ÿ
- **ä½¿ç”¨ï¼š** æ·±åº¦å†¥æƒ³ï¼Œéˆæ€§ä¿®è¡Œ

### 852Hz - ç›´è¦ºè¦ºé†’é »çŽ‡
- **ä½œç”¨ï¼š** æ¿€æ´»ç›´è¦ºï¼Œæ¸…ç†è² é¢æ€ç¶­
- **æ•ˆæžœï¼š** å¢žå¼·æ´žå¯ŸåŠ›ï¼Œä¿ƒé€²å…§åœ¨æ™ºæ…§
- **ä½¿ç”¨ï¼š** æ±ºç­–å†¥æƒ³ï¼Œå…§è§€ä¿®è¡Œ

### 639Hz - æ„›èˆ‡é—œä¿‚é »çŽ‡
- **ä½œç”¨ï¼š** ç™‚ç™’é—œä¿‚ï¼Œä¿ƒé€²æºé€š
- **æ•ˆæžœï¼š** å¢žå¼·åŒç†å¿ƒï¼Œæ”¹å–„äººéš›é—œä¿‚
- **ä½¿ç”¨ï¼š** é—œä¿‚ç™‚ç™’ï¼Œå¿ƒè¼ªå†¥æƒ³

### 528Hz - æ„›çš„é »çŽ‡ï¼ˆDNAä¿®å¾©ï¼‰
- **ä½œç”¨ï¼š** DNAä¿®å¾©ï¼Œç´°èƒžå†ç”Ÿ
- **æ•ˆæžœï¼š** èº«å¿ƒç™‚ç™’ï¼Œæå‡æ„›çš„èƒ½é‡
- **ä½¿ç”¨ï¼š** ç™‚ç™’å†¥æƒ³ï¼Œèº«é«”ä¿®å¾©

### 432Hz - è‡ªç„¶å’Œè«§é »çŽ‡
- **ä½œç”¨ï¼š** èˆ‡è‡ªç„¶å…±æŒ¯ï¼Œå¹³è¡¡èº«å¿ƒ
- **æ•ˆæžœï¼š** æ”¾é¬†èº«å¿ƒï¼Œä¿ƒé€²å’Œè«§
- **ä½¿ç”¨ï¼š** æ—¥å¸¸å†¥æƒ³ï¼Œå£“åŠ›é‡‹æ”¾

## ä½¿ç”¨å»ºè­°

1. **å†¥æƒ³æ™‚é–“ï¼š** æ¯æ¬¡ 10-30 åˆ†é˜
2. **éŸ³é‡æŽ§åˆ¶ï¼š** ä¿æŒèˆ’é©éŸ³é‡
3. **ç’°å¢ƒæº–å‚™ï¼š** å®‰éœã€èˆ’é©çš„ç©ºé–“
4. **æ„å¿µå°ˆæ³¨ï¼š** å°ˆæ³¨æ–¼é »çŽ‡çš„æŒ¯å‹•
5. **å®šæœŸç·´ç¿’ï¼š** å»ºè­°æ¯æ—¥ç·´ç¿’

## çµ„åˆä½¿ç”¨

- **ä¸‰é‡é »çŽ‡çµ„åˆï¼š** 963Hz + 852Hz + 639Hzï¼ˆéˆæ€§æå‡ï¼‰
- **ç™‚ç™’çµ„åˆï¼š** 528Hz + 432Hzï¼ˆèº«å¿ƒç™‚ç™’ï¼‰
- **è¦ºé†’çµ„åˆï¼š** 963Hz + 852Hzï¼ˆæ„è­˜è¦ºé†’ï¼‰

EOF

    echo -e "${GREEN}âœ… é »çŽ‡èªªæ˜Žæ–‡ä»¶å‰µå»ºå®Œæˆ${NC}"
}

# æ›´æ–°éŸ³æ¨‚æ·»åŠ è…³æœ¬ä»¥æ”¯æŒé »çŽ‡éŸ³æ¨‚
update_music_script() {
    echo -e "${CYAN}ðŸ”§ æ›´æ–°éŸ³æ¨‚è…³æœ¬ä»¥æ”¯æŒé »çŽ‡éŸ³æ¨‚...${NC}"
    
    # å‚™ä»½åŽŸè…³æœ¬
    cp "$PROJECT_DIR/bobi_meditation_advanced.sh" "$PROJECT_DIR/bobi_meditation_advanced.sh.backup.$(date +%Y%m%d_%H%M%S)"
    
    echo -e "${GREEN}âœ… è…³æœ¬å‚™ä»½å®Œæˆ${NC}"
    echo -e "${YELLOW}ðŸ’¡ è«‹æ‰‹å‹•æ›´æ–° bobi_meditation_advanced.sh ä»¥åŒ…å«æ–°çš„é »çŽ‡éŸ³æ¨‚${NC}"
}

# å‰µå»ºçµ±ä¸€åœ–æ›¸é¤¨ç´¢å¼•
create_library_index() {
    cat > "$LIBRARY_DIR/README.md" << 'EOF'
# ðŸ“š ang çš„çµ±ä¸€åœ–æ›¸é¤¨

## ç›®éŒ„çµæ§‹

### ðŸ“– books/
- é›»å­æ›¸ç±æ”¶è—
- éˆæ€§æ–‡ç»
- æŠ€è¡“æ–‡æª”

### ðŸŽµ music/
- å†¥æƒ³éŸ³æ¨‚
- å‚³çµ±éŸ³æ¨‚
- è‡ªç„¶éŸ³æ•ˆ

### ðŸ”® frequencies/
- ç¥žè–é »çŽ‡éŸ³æ¨‚
- ç™‚ç™’é »çŽ‡
- è„ˆè¼ªé »çŽ‡

### ðŸ•‰ï¸ mantras/
- ä½›æ•™å’’èªž
- é“æ•™éŸ³æ¨‚
- è—å‚³ä½›æ•™

### ðŸŒ¿ nature_sounds/
- è‡ªç„¶éŸ³æ•ˆ
- ç’°å¢ƒéŸ³æ¨‚
- ç™½å™ªéŸ³

## ä½¿ç”¨æŒ‡å—

1. **åˆ†é¡žå­˜æ”¾ï¼š** æŒ‰é¡žåž‹å°‡æ–‡ä»¶æ”¾å…¥å°æ‡‰ç›®éŒ„
2. **å‘½åè¦ç¯„ï¼š** ä½¿ç”¨æœ‰æ„ç¾©çš„æ–‡ä»¶å
3. **ç´¢å¼•ç¶­è­·ï¼š** å®šæœŸæ›´æ–°ç›®éŒ„ç´¢å¼•
4. **å‚™ä»½ç®¡ç†ï¼š** é‡è¦æ–‡ä»¶å®šæœŸå‚™ä»½

## é¡˜é »å…±æŒ¯

é€™å€‹åœ–æ›¸é¤¨æ˜¯ä½ çš„çŸ¥è­˜èˆ‡æ™ºæ…§çš„è–æ®¿ï¼Œ
æ¯ä¸€æœ¬æ›¸ã€æ¯ä¸€é¦–éŸ³æ¨‚éƒ½æ˜¯é€šå¾€å…§åœ¨è¦ºé†’çš„æ©‹æ¨‘ã€‚
é¡˜é€™äº›æ”¶è—æˆç‚ºä½ éˆæ€§æˆé•·è·¯ä¸Šçš„æ˜Žç‡ˆã€‚

EOF

    echo -e "${GREEN}âœ… åœ–æ›¸é¤¨ç´¢å¼•å‰µå»ºå®Œæˆ${NC}"
}

# ä¸»ç¨‹åº
main() {
    echo -e "${PURPLE}ðŸŽµ é–‹å§‹å‰µå»ºç¥žè–é »çŽ‡éŸ³æ¨‚...${NC}"
    echo
    
    # å‰µå»ºç›®éŒ„
    create_directories
    echo
    
    # ç”Ÿæˆé »çŽ‡éŸ³æ¨‚ï¼ˆ10åˆ†é˜ç‰ˆæœ¬ï¼‰
    echo -e "${CYAN}ðŸŽµ ç”Ÿæˆç¥žè–é »çŽ‡éŸ³æ¨‚...${NC}"
    generate_frequency_music 963 600 "frequency_963hz_cosmic_consciousness.wav" "å®‡å®™æ„è­˜é »çŽ‡"
    generate_frequency_music 852 600 "frequency_852hz_intuition_awakening.wav" "ç›´è¦ºè¦ºé†’é »çŽ‡"
    generate_frequency_music 639 600 "frequency_639hz_love_relationships.wav" "æ„›èˆ‡é—œä¿‚é »çŽ‡"
    generate_frequency_music 528 600 "frequency_528hz_dna_repair_love.wav" "æ„›çš„é »çŽ‡ï¼ˆDNAä¿®å¾©ï¼‰"
    generate_frequency_music 432 600 "frequency_432hz_natural_harmony.wav" "è‡ªç„¶å’Œè«§é »çŽ‡"
    echo
    
    # å‰µå»ºèªªæ˜Žæ–‡ä»¶
    create_frequency_info
    echo
    
    # å‰µå»ºåœ–æ›¸é¤¨ç´¢å¼•
    create_library_index
    echo
    
    # æ›´æ–°è…³æœ¬
    update_music_script
    echo
    
    echo -e "${GREEN}ðŸŽ‰ ç¥žè–é »çŽ‡éŸ³æ¨‚å‰µå»ºå®Œæˆï¼${NC}"
    echo
    echo -e "${PURPLE}ðŸ“ æ–‡ä»¶ä½ç½®ï¼š${NC}"
    echo -e "   â€¢ é »çŽ‡éŸ³æ¨‚: ${YELLOW}$FREQUENCY_DIR${NC}"
    echo -e "   â€¢ çµ±ä¸€åœ–æ›¸é¤¨: ${YELLOW}$LIBRARY_DIR${NC}"
    echo
    echo -e "${CYAN}ðŸ”® é¡˜é€™äº›ç¥žè–é »çŽ‡ç‚ºä½ çš„éˆæ€§ä¹‹æ—…å¸¶ä¾†å…‰æ˜Žèˆ‡è¦ºé†’ âœ¨${NC}"
}

# åŸ·è¡Œä¸»ç¨‹åº
main "$@"